<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/7/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-IDE/eclipse" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/18/IDE/eclipse/" class="article-date">
  <time class="dt-published" datetime="2021-01-18T11:01:37.264Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li>添加模板：window-&gt;Preferences搜索templates，在Java-&gt;Editor中</li>
<li>添加设置工作空间默认编码：window-&gt;Preferences-&gt;General-&gt;workspace中Text file encoding</li>
<li>设置jsp文件默认编码：window-&gt;Preferences-&gt;Web-&gt;JSP File中修改Ecoding</li>
<li>eclipse生成get和set方法shift+alt+s</li>
<li>eclipse自动创建对象shift+alt+leclipse</li>
<li>删除当前行ctrl+d</li>
<li>HTML、JSP注释命令ctrl+shift+/</li>
<li>eclipse中ctrl+shift+t快捷打开类</li>
<li>eclipse中选中方法按快捷键ctrl+1选择第二项快捷创建方法返回值对象</li>
<li>eclipse中光标所在行按ctrl+alt+上下键复制当前行</li>
<li>eclipse中光标所在行按alt+上下键可以移动代码行</li>
<li>eclipse导入项目有红叉，大概率是jdk版本不对，在Build Path-&gt;Configure Build Path-Libraies中删除带红叉的jdk，然后Add Library-&gt;JRE System Library添加自己的jdk，若仍然有错，Add Library-&gt;Server Runtime添加自己的tomcat</li>
<li>eclipse中导入约束文件window-&gt;Preferences-&gt;XML-&gt;XML Catalog-&gt;点击add-&gt;Location中点击File System选择约束文件key填写对应uri</li>
<li>ctrl+m扩大缩小窗口</li>
<li>ctrl+t查找接口实现类</li>
<li>ctrl+o查看类中方法</li>
<li>eclipse导入spring约束文件window-&gt;Preferences-&gt;XML-&gt;XML Catalog-&gt;点击add-&gt;Location中点击File System选择spring/schema/beans中xsd文件Key Type选择Schema location,Key在默认值后加/+约束文件名,然后在applicationConext.xml文件中写<beans></beans>节点,切换到Design视图中右键beans,选择Edit Namespaces点击add,选择第一个xsi,确认,再点击add选择Specify New Namespaces,在Location Hint栏位先择select XML Catalog entry,选中spring的约束文件,Namespace Name栏位填写,Location Hint栏位中不包含”/+约束文件名”的部分,确定保存即可</li>
<li>eclipse自动提示spring配置类:<ol>
<li>Help-&gt;About Eclipse点击Eclipse图标查看版本              </li>
<li>Help-&gt;Install New Software,在Work with栏位输出 <a target="_blank" rel="noopener" href="http://dist.springsource.com/release/TOOLS/update/e%E7%89%88%E6%9C%AC%E5%8F%B7(4.5)/">http://dist.springsource.com/release/TOOLS/update/e版本号(4.5)/</a>              </li>
<li>勾选spring IDE的四个,去掉Contact all update选项安装更快,点击Next,eclipse查找完成后点击Next          </li>
<li>选择I accepte the termsof the license agreements ,点击finish,安装完成后重启eclipse即可alt+/提示        </li>
<li>window-&gt;Link with Editor点击可打开类对应的文件</li>
</ol>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/18/IDE/eclipse/" data-id="ckk2gq3t60007z8pqcpq3dwln" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Git/Git" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/18/Git/Git/" class="article-date">
  <time class="dt-published" datetime="2021-01-18T11:01:37.260Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miwanmeng/article/details/81128353">idea集成和使用git步骤</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/18/Git/Git/" data-id="ckk2gq3t50006z8pq3w61d73h" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ElasticSearch/ES实现问答系统" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/18/ElasticSearch/ES%E5%AE%9E%E7%8E%B0%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/" class="article-date">
  <time class="dt-published" datetime="2021-01-18T11:01:37.256Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/balloon72/p/13177872.html">使用ES搭建问答系统</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/18/ElasticSearch/ES%E5%AE%9E%E7%8E%B0%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/" data-id="ckk2gq3t30004z8pqaysv61hb" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Docker/Docker" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/18/Docker/Docker/" class="article-date">
  <time class="dt-published" datetime="2021-01-18T11:01:37.242Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h4><p><strong>Docker</strong>是一个开源的应用容器引擎；是一个轻量级容器技术；</p>
<p>Docker支持将软件编译成一个镜像；然后在镜像中各种软件做好配置，将镜像发布出去，其他使用者可以直接使用这个镜像；</p>
<p>运行中的这个镜像称为容器，容器启动是非常快速的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/FateCause/typoraPic/images/Docker%E5%9B%BE%E6%A0%87.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/FateCause/typoraPic/images/%E9%95%9C%E5%83%8F%E4%BB%8B%E7%BB%8D.png"></p>
<h4 id="2、核心概念"><a href="#2、核心概念" class="headerlink" title="2、核心概念"></a>2、核心概念</h4><p>docker主机(Host)：安装了Docker程序的机器（Docker直接安装在操作系统之上）；</p>
<p>docker客户端(Client)：连接docker主机进行操作；</p>
<p>docker仓库(Registry)：用来保存各种打包好的软件镜像；</p>
<p>docker镜像(Images)：软件打包好的镜像；放在docker仓库中；</p>
<p>docker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用</p>
<p><img src="https://cdn.jsdelivr.net/gh/FateCause/typoraPic/images/Docker%E5%85%B3%E7%B3%BB%E5%9B%BE.png"></p>
<p>使用Docker的步骤：</p>
<p>1）、安装Docker</p>
<p>2）、去Docker仓库找到这个软件对应的镜像；</p>
<p>3）、使用Docker运行这个镜像，这个镜像就会生成一个Docker容器；</p>
<p>4）、对容器的启动停止就是对软件的启动停止；</p>
<h4 id="3、安装Docker"><a href="#3、安装Docker" class="headerlink" title="3、安装Docker"></a>3、安装Docker</h4><h5 id="1）、安装linux虚拟机"><a href="#1）、安装linux虚拟机" class="headerlink" title="1）、安装linux虚拟机"></a>1）、安装linux虚拟机</h5><p>​    1）、VMWare、VirtualBox（安装）；</p>
<p>​    2）、导入虚拟机文件centos7-atguigu.ova；</p>
<p>​    3）、双击启动linux虚拟机;使用  root/ 123456登陆</p>
<p>​    4）、使用客户端连接linux服务器进行命令操作；</p>
<p>​    5）、设置虚拟机网络；</p>
<p>​        桥接网络===选好网卡====接入网线；</p>
<p>​    6）、设置好网络以后使用命令重启虚拟机的网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>
<p>​    7）、查看linux的ip地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure>
<p>​    8）、使用客户端连接linux；</p>
<h5 id="2）、在linux虚拟机上安装docker"><a href="#2）、在linux虚拟机上安装docker" class="headerlink" title="2）、在linux虚拟机上安装docker"></a>2）、在linux虚拟机上安装docker</h5><p>步骤：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1、检查内核版本，必须是3.10及以上</span><br><span class="line">uname -r</span><br><span class="line">若内核版本太低yum update更新</span><br><span class="line">2、安装docker</span><br><span class="line">yum install docker</span><br><span class="line">3、输入y确认安装</span><br><span class="line">4、启动docker</span><br><span class="line">[root@localhost ~]# systemctl start docker</span><br><span class="line">[root@localhost ~]# docker -v</span><br><span class="line">Docker version 1.12.6, build 3e8e77d/1.12.6</span><br><span class="line">5、开机启动docker</span><br><span class="line">[root@localhost ~]# systemctl enable docker</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">6、停止docker</span><br><span class="line">systemctl stop docker</span><br><span class="line">7、查看docker状态</span><br><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure>
<h4 id="4、配置阿里云镜像"><a href="#4、配置阿里云镜像" class="headerlink" title="4、配置阿里云镜像"></a>4、配置阿里云镜像</h4><p><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">配置docker阿里镜像加速</a></p>
<p>按步骤指导配置阿里云镜像加速，以centos7为例执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">	1）sudo mkdir -p /etc/docker</span><br><span class="line">	若存在文件夹可跳过</span><br><span class="line"></span><br><span class="line">	2）sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://uw5moiq5.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">	3)sudo systemctl daemon-reload</span><br><span class="line">	4)sudo systemctl restart docker</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h4 id="5、Docker常用命令-amp-操作"><a href="#5、Docker常用命令-amp-操作" class="headerlink" title="5、Docker常用命令&amp;操作"></a>5、Docker常用命令&amp;操作</h4><h5 id="1）镜像操作"><a href="#1）镜像操作" class="headerlink" title="1）镜像操作"></a>1）镜像操作</h5><table>
<thead>
<tr>
<th>操作</th>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>检索</td>
<td>docker  search 关键字  eg：docker  search redis</td>
<td>我们经常去docker  hub上检索镜像的详细信息，如镜像的TAG。</td>
</tr>
<tr>
<td>拉取</td>
<td>docker pull 镜像名:tag</td>
<td>:tag是可选的，tag表示标签，多为软件的版本，默认是latest</td>
</tr>
<tr>
<td>列表</td>
<td>docker images</td>
<td>查看所有本地镜像</td>
</tr>
<tr>
<td>删除</td>
<td>docker rmi image-id</td>
<td>删除指定的本地镜像</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p>docker pull下来的镜像：</p>
<p>​    /var/lib/docker/containers/镜像序号</p>
<p>​    进入image文件夹，里面有repositories.json的文件，详细记录了各镜像的一些信息</p>
<h5 id="2）容器操作"><a href="#2）容器操作" class="headerlink" title="2）容器操作"></a>2）容器操作</h5><p>软件镜像（QQ安装程序）—-运行镜像—-产生一个容器（正在运行的软件，运行的QQ）；</p>
<p>步骤：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">1、搜索镜像</span><br><span class="line">[root@localhost ~]# docker search tomcat</span><br><span class="line">2、拉取镜像</span><br><span class="line">[root@localhost ~]# docker pull tomcat:8.0.35 </span><br><span class="line">	tomcat8.0.35可以直接访问，更高版本的没有webapp无法直接访问</span><br><span class="line">3、根据镜像启动容器</span><br><span class="line">docker run --name mytomcat -d tomcat:latest</span><br><span class="line">4、docker ps  </span><br><span class="line">查看运行中的容器</span><br><span class="line">5、 停止运行中的容器</span><br><span class="line">docker stop  容器的id</span><br><span class="line">6、查看所有的容器</span><br><span class="line">docker ps -a</span><br><span class="line">7、启动容器</span><br><span class="line">docker start 容器id</span><br><span class="line">8、删除一个容器</span><br><span class="line"> docker rm 容器id</span><br><span class="line">9、启动一个做了端口映射的tomcat</span><br><span class="line">[root@localhost ~]# docker run -d -p 8888:8080 tomcat</span><br><span class="line">-d：后台运行</span><br><span class="line">-p: 将主机的端口映射到容器的一个端口    主机端口:容器内部的端口</span><br><span class="line"></span><br><span class="line">10、为了演示简单关闭了linux的防火墙</span><br><span class="line">service firewalld status ；查看防火墙状态</span><br><span class="line">service firewalld stop：关闭防火墙</span><br><span class="line">11、查看容器的日志</span><br><span class="line">docker logs container-name/container-id</span><br><span class="line">12、指定容器挂在路径</span><br><span class="line">docker -v</span><br><span class="line">13、指定容器启动的内存大小</span><br><span class="line">docker -m</span><br><span class="line"></span><br><span class="line">14、docker进入容器执行命令</span><br><span class="line">docker exec -it 容器id /bin/bash</span><br><span class="line"></span><br><span class="line">15、查看镜像的版本号</span><br><span class="line">docker image inspect nginx:latest | grep -i version</span><br><span class="line"></span><br><span class="line">16、centos7中Docker挂载主机目录，访问相应的文件出现Premission denied的权限访问问题，解决方法</span><br><span class="line">问题原因及解决办法</span><br><span class="line">   原因是CentOS7中的安全模块selinux把权限禁掉了，至少有以下三种方式解决挂载的目录没有权限的问题：</span><br><span class="line">   1.在运行容器的时候，给容器加特权，及加上 --privileged=true 参数：</span><br><span class="line">   docker run -i -t -v /soft:/soft --privileged=true 686672a1d0cc /bin/bash</span><br><span class="line">   2.临时关闭selinux：</span><br><span class="line">   setenforce 0</span><br><span class="line">   3.添加selinux规则，改变要挂载的目录的安全性文本</span><br><span class="line">   chcon -Rt svirt_sandbox_file_t 挂在文件夹</span><br><span class="line"></span><br><span class="line">17、允许容器之间互相通信</span><br><span class="line">docker network ls</span><br><span class="line">1)docker --link 容器名</span><br><span class="line">2)查看现在的网络:docker network ls</span><br><span class="line">	创建网络:docker network create test-network</span><br><span class="line">	启动容器时，加入创建的网络:docker run -it --network test-network --network-alias mysql  -e MYSQL_ROOT_PASSWORD=123 mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">18、查看Docker的网络策略</span></span><br><span class="line">docker network ls</span><br><span class="line">Docker有三种网络模式，bridge、host、none，在你创建容器的时候，不指定--network默认是bridge。</span><br><span class="line">bridge：为每一个容器分配IP，并将容器连接到一个docker0虚拟网桥，通过docker0网桥与宿主机通信。也就是说，此模式下，你不能用宿主机的IP+容器映射端口来进行Docker容器之间的通信。</span><br><span class="line">host：容器不会虚拟自己的网卡，配置自己的IP，而是使用宿主机的IP和端口。这样一来，Docker容器之间的通信就可以用宿主机的IP+容器映射端口</span><br><span class="line">none：无网络。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">更多命令参看</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/docker/</span><br><span class="line">可以参考每一个镜像的文档</span><br></pre></td></tr></table></figure>
<h5 id="3）安装MySQL示例"><a href="#3）安装MySQL示例" class="headerlink" title="3）安装MySQL示例"></a>3）安装MySQL示例</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br><span class="line">	现有的navicat只支持访问mysql5.7，更高的不能访问</span><br></pre></td></tr></table></figure>
<p>错误的启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -d mysql</span><br><span class="line">42f09819908bb72dd99ae19e792e0a5d03c48638421fa64cce5f8ba0f40f5846</span><br><span class="line"></span><br><span class="line">mysql退出了</span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                           PORTS               NAMES</span><br><span class="line">42f09819908b        mysql               &quot;docker-entrypoint.sh&quot;   34 seconds ago      Exited (1) 33 seconds ago                            mysql01</span><br><span class="line">538bde63e500        tomcat              &quot;catalina.sh run&quot;        About an hour ago   Exited (143) About an hour ago                       compassionate_</span><br><span class="line">goldstine</span><br><span class="line">c4f1ac60b3fc        tomcat              &quot;catalina.sh run&quot;        About an hour ago   Exited (143) About an hour ago                       lonely_fermi</span><br><span class="line">81ec743a5271        tomcat              &quot;catalina.sh run&quot;        About an hour ago   Exited (143) About an hour ago                       sick_ramanujan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//错误日志</span><br><span class="line">[root@localhost ~]# docker logs 42f09819908b</span><br><span class="line">error: database is uninitialized and password option is not specified </span><br><span class="line">  You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD；这个三个参数必须指定一个</span><br></pre></td></tr></table></figure>
<p>正确的启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">b874c56bec49fb43024b3805ab51e9097da779f2f572c22c695305dedd684c5f</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">b874c56bec49        mysql               &quot;docker-entrypoint.sh&quot;   4 seconds ago       Up 3 seconds        3306/tcp            mysql01</span><br></pre></td></tr></table></figure>
<p>做了端口映射</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -p 3306:3306 --name mysql02 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">ad10e4bc5c6a0f61cbad43898de71d366117d120e39db651844c0e73863b9434</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">ad10e4bc5c6a        mysql               &quot;docker-entrypoint.sh&quot;   4 seconds ago       Up 2 seconds        0.0.0.0:3306-&gt;3306/tcp   mysql02</span><br></pre></td></tr></table></figure>
<p>几个其他的高级操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql03 -v /conf/mysql:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag*</span><br><span class="line">把主机的/conf/mysql文件夹挂载到 mysqldocker容器的/etc/mysql/conf.d文件夹里面</span><br><span class="line">改mysql的配置文件就只需要把mysql配置文件放在自定义的文件夹下（/conf/mysql）</span><br><span class="line"></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</span><br><span class="line">指定mysql的一些配置参数</span><br></pre></td></tr></table></figure>
<h5 id="4）安装ElasticSearch"><a href="#4）安装ElasticSearch" class="headerlink" title="4）安装ElasticSearch"></a>4）安装ElasticSearch</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32101993/article/details/100021002">docker安装ElasticSearch详解</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1、搜索镜像</span><br><span class="line">docker search elasticsearch</span><br><span class="line"></span><br><span class="line">2、下载镜像</span><br><span class="line">docker pull docker.io/elasticsearch:版本号</span><br><span class="line"></span><br><span class="line">3、启动容器</span><br><span class="line">docker run -d --name myes -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; 5acf0e8da90b</span><br><span class="line"></span><br><span class="line">-e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;调整分配内存</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="5）安装Nacos"><a href="#5）安装Nacos" class="headerlink" title="5）安装Nacos"></a>5）安装Nacos</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1、搜索镜像</span><br><span class="line">docker search nacos/nacos-server:版本号</span><br><span class="line"></span><br><span class="line">2、docker pull nacos/nacos-server:版本号</span><br><span class="line"></span><br><span class="line">3、创建配置文件并添加配置</span><br><span class="line">mkdir nacos/init.d</span><br><span class="line">touch custom.properties</span><br><span class="line">vi配置文件并写入：management.endpoints.web.exposure.include=*</span><br><span class="line"></span><br><span class="line">4、使用standalone模式并开放8848端口，并映射配置文件和日志目录，数据库默认使用 Derby</span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run -d -p 8848:8848 -e MODE=standalone -v /opt/nacos/init.d/custom.properties:/root/nacos/init.d/custom.properties -v /opt/nacos/logs:/root/nacos/logs --restart always --name nacos-1.1.4 nacos/nacos-server:1.1.4</span></span><br><span class="line"></span><br><span class="line">5、测试访问</span><br><span class="line">直接访问 http://127.0.0.1:8848/nacos， 使用账号：nacos，密码：nacos 直接登录。nacos是默认账号和密码，登录成功后可以修改密码。</span><br></pre></td></tr></table></figure>
<h5 id="6）安装neo4j"><a href="#6）安装neo4j" class="headerlink" title="6）安装neo4j"></a>6）安装neo4j</h5><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/caoyusang/p/13610408.html">参考链接地址</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1、拉取指定版本的镜像</span></span><br><span class="line">docker pull neo4j:3.5.8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2、创建是个映射文件夹</span></span><br><span class="line">data——数据存放的文件夹</span><br><span class="line">logs——运行的日志文件夹</span><br><span class="line">conf——数据库配置文件夹（在配置文件neo4j.conf中配置包括开放远程连接、设置默认激活的数据库）</span><br><span class="line">import——为了大批量导入csv来构建数据库，需要导入的节点文件nodes.csv和关系文件rel.csv需要放到这个文件夹下）</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">3、启动neo4j容器并挂载目录</span></span><br><span class="line">docker run -d --name neo4j-3.5.8 -p 7474:7474 -p 7687:7687 -v $HOME/neo4j/data:/var/lib/neo4j/data -v $HOME/neo4j/logs:/var/lib/neo4j/logs -v $HOME/neo4j/conf:/var/lib/neo4j/conf -v $HOME/neo4j/import:/var/lib/neo4j/import --env NEO4J_AUTH=neo4j/yjb123456 --privileged=true neo4j:3.5.8</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#给容器添加挂载目录的权限：--privileged=true</span></span> </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#给neo4j设置了密码：NEO4J_AUTH=neo4j/yjb123456</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2、创建jenkins挂在的目录并修改权限</span></span><br><span class="line">docker run -ti --rm --entrypoint=&quot;/bin/bash&quot; neo4j:3.5.8 -c &quot;id neo4j&quot;</span><br><span class="line">chown -R 101 $HOME/neo4j</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">4、添加selinux规则，改变要挂载的目录的安全性文本</span></span><br><span class="line">chcon -Rt svirt_sandbox_file_t $HOME/neo4j</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">5、neo4j配置，视情况是否必要</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器配置目录挂载在宿主机的对应目录，我这里是/home/neo4j/conf</span></span><br><span class="line">cd /home/neo4j/conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> vim编辑器打开neo4j.conf</span></span><br><span class="line">vim neo4j.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进行以下更改</span></span><br><span class="line"><span class="meta">#</span><span class="bash">在文件配置末尾添加这一行</span></span><br><span class="line">dbms.connectors.default_listen_address=0.0.0.0  //指定连接器的默认监听ip为0.0.0.0，即允许任何ip连接到数据库</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#修改</span></span></span><br><span class="line">dbms.connector.bolt.listen_address=0.0.0.0:7687  //取消注释并把对bolt请求的监听“地址:端口”改为“0.0.0.0:7687”</span><br><span class="line">dbms.connector.http.listen_address=0.0.0.0:7474  //取消注释并把对http请求的监听“地址:端口”改为“0.0.0.0:7474”</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">6、查看当前防火墙状态，若为“inactive”，则防火墙已关闭，不必进行接续操作。</span></span><br><span class="line">service firewalld status</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 若防火墙状态为“active”，则使用下列命令开放端口</span></span><br><span class="line">sudo ufw allow 7474</span><br><span class="line">sudo ufw allow 7687</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">重启防火墙</span></span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure>
<h5 id="7）安装Jenkins"><a href="#7）安装Jenkins" class="headerlink" title="7）安装Jenkins"></a>7）安装Jenkins</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">如果你看过 Jenkins 文档中 Docker 安装 小节，会发现官方推荐使用的镜像是jenkinsci/blueocean，该镜像包含当前的长期支持 (LTS) 的 Jenkins 版本 (可以生产使用) ，并捆绑了所有 Blue Ocean 插件和功能。如果使用的是jenkins镜像，其集成的 Jenkins 版本比较高，结果出现好多插件不兼容的情况，对于我等小白来说是一件比较麻烦的事。</span><br><span class="line"><span class="meta">#</span><span class="bash">1、拉取指定版本的镜像</span></span><br><span class="line">docker pull jenkinsci/blueocean:版本号</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2、创建jenkins挂在的目录并修改权限</span></span><br><span class="line">mkdir -p $HOME/jenkins_home</span><br><span class="line"><span class="meta">#</span><span class="bash">查看jenkins用户</span></span><br><span class="line">docker run -ti --rm --entrypoint=&quot;/bin/bash&quot; jenkinsci/blueocean -c &quot;id jenkins&quot;	</span><br><span class="line">chown -R 1000 $HOME/jenkins_home</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">4、添加selinux规则，改变要挂载的目录的安全性文本</span></span><br><span class="line">chcon -Rt svirt_sandbox_file_t /root/jenkins_home</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">4、启动jenkins容器并挂载目录,若不挂载目录，容器销毁数据会全部丢失</span></span><br><span class="line">docker run --name jenkinsci-blueocean -d -p 50001:8080 -p 50000:50000 -v $HOME/jenkins_home:/var/jenkins_home \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock jenkinsci/blueocean:版本号</span><br><span class="line"><span class="meta">#</span><span class="bash"> Tips：8080 端口用来公开访问 Web 界面，50000 端口允许访问远程 Java (JIRA) API</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">5、以上如果一切正常，现在就可以通过http://&lt;ipaddress&gt;:8080访问 Jenkins 的 Web 界面</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">6、查看管理员密码，管理员初始密码被放到了/var/jenkins_home/secrets/initialAdminPassword 文件中，需进入容器内部查看</span></span><br><span class="line">docker exec -it jenkinsci-blueocean /bin/bash -c &quot;cat /var/jenkins_home/secrets/initialAdminPassword&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看docker执行权限的操作</span></span><br><span class="line">docker run -ti --rm --entrypoint=&quot;/bin/bash&quot; jenkinsci/blueocean -c &quot;whoami &amp;&amp; id&quot;</span><br><span class="line">docker run -ti --rm --entrypoint=&quot;/bin/bash&quot; jenkinsci/blueocean -c &quot;ls -la /var/jenkins_home&quot;</span><br><span class="line">docker run -ti --rm -v /root/jenkins_home:/var/jenkins_home --entrypoint=&quot;/bin/bash&quot; jenkinsci/blueocean -c &quot;ls -la /var/jenkins_home&quot;</span><br></pre></td></tr></table></figure>
<h5 id="8）安装WordPress"><a href="#8）安装WordPress" class="headerlink" title="8）安装WordPress"></a>8）安装WordPress</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1、拉取指定版本的镜像</span></span><br><span class="line">docker pull wordpress:版本号</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2、启动WordPress容器设置依赖的mysql地址</span></span><br><span class="line">docker run -it -e WORDPRESS_DB_HOST=192.168.80.129:3306 -e WORDPRESS_DB_USESR=root -e WORDPRESS_DB_PASSWORD=123456 -p 8080:80 -d wordpress:版本号</span><br></pre></td></tr></table></figure>
<h5 id="9）安装zookeeper"><a href="#9）安装zookeeper" class="headerlink" title="9）安装zookeeper"></a>9）安装zookeeper</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1、下载zookeeper镜像，wurstmeister/zookeeper版本比较旧但配置比较全，zookeeper版本比较全缺少配置</span></span><br><span class="line">docker pull wurstmeister/zookeeper</span><br><span class="line">docker pull zookeeper:3.5.8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2、创建zookeeper挂在的目录并修改权限</span></span><br><span class="line">mkdir -p $HOME/zookeeper</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看zookeeper用户</span></span><br><span class="line">docker run -ti --rm --entrypoint=&quot;/bin/bash&quot; zookeeper:3.5.8 -c &quot;id zookeeper&quot;</span><br><span class="line">chown -R 1001 $HOME/zookeeper</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2、启动zookeeper容器</span></span><br><span class="line">docker run -itd --name zookeeper-3.5.8 -p 2181:2181 -v /etc/localtime:/etc/localtime -v  zookeeper:3.5.8</span><br><span class="line">docker run -itd --name zookeeper -p 2181:2181 -v /etc/localtime:/etc/localtime -v  wurstmeister/zookeeper</span><br></pre></td></tr></table></figure>
<h5 id="10）安装kafka"><a href="#10）安装kafka" class="headerlink" title="10）安装kafka"></a>10）安装kafka</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1、下载和安装zookeeper镜像</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2、下载kafka镜像</span></span><br><span class="line">docker pull wurstmeister/kafka</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">3、启动kafka容器</span></span><br><span class="line">docker run  -d --name kafka -p 9092:9092 --link zookeeper-3.5.6 -e KAFKA_BROKER_ID=0 -e KAFKA_ZOOKEEPER_CONNECT=192.168.56.80:2181 -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://192.168.56.80:9092 -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 -t wurstmeister/kafka</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">4、测试消息</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h4 id="6、卸载docker"><a href="#6、卸载docker" class="headerlink" title="6、卸载docker"></a>6、卸载docker</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kingsonfu/p/11582495.html">卸载docker步骤</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/18/Docker/Docker/" data-id="ckk2gq3ud001jz8pqbf4iemw7" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-DevOps/DevOps" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/18/DevOps/DevOps/" class="article-date">
  <time class="dt-published" datetime="2021-01-18T11:01:37.221Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="Devops"><a href="#Devops" class="headerlink" title="Devops"></a>Devops</h3><p>最近老是碰到这个名词，所以想了解一下这个到底是撒玩意？</p>
<blockquote>
<p>DevOps（Development和Operations的组合词）是一组过程、方法与系统的统称，用于促进开发（应用程序/软件工程）、技术运营和质量保障（QA）部门之间的沟通、协作与整合。</p>
<p>它是一种重视“软件开发人员（Dev）”和“IT运维技术人员（Ops）”之间沟通合作的文化、运动或惯例。透过自动化“软件交付”和“架构变更”的流程，来使得构建、测试、发布软件能够更加地快捷、频繁和可靠。</p>
<p>它的出现是由于软件行业日益清晰地认识到：为了按时交付软件产品和服务，开发和运营工作必须紧密合作。</p>
</blockquote>
<p>从定义来看，其实devops就是为了让开发、运维和QA可以高效协作的流程。（可以把DevOps看作开发、技术运营和质量保障（QA）三者的交集。）</p>
<p><img src="https://cdn.jsdelivr.net/gh/FateCause/typoraPic/images/1658016-161d35578db8e79b.png" alt="img"></p>
<h4 id="DevOps对应用程序发布的影响"><a href="#DevOps对应用程序发布的影响" class="headerlink" title="DevOps对应用程序发布的影响"></a><strong>DevOps对应用程序发布的影响</strong></h4><p>在很多企业中，应用程序发布是一项涉及多个团队、压力很大、风险很高的活动。然而在具备DevOps能力的组织中，应用程序发布的风险很低，原因如下 [2] ：</p>
<h5 id="（1）减少变更范围"><a href="#（1）减少变更范围" class="headerlink" title="（1）减少变更范围"></a><strong>（1）减少变更范围</strong></h5><p>与传统的瀑布模式模型相比，采用敏捷或迭代式开发意味着更频繁的发布、每次发布包含的变化更少。由于部署经常进行，因此每次部署不会对生产系统造成巨大影响，应用程序会以平滑的速率逐渐生长。</p>
<h5 id="（2）加强发布协调"><a href="#（2）加强发布协调" class="headerlink" title="（2）加强发布协调"></a><strong>（2）加强发布协调</strong></h5><p>靠强有力的发布协调人来弥合开发与运营之间的技能鸿沟和沟通鸿沟；采用电子数据表、电话会议和企业门户（wiki、sharepoint）等协作工具来确保所有相关人员理解变更的内容并全力合作。</p>
<h5 id="（3）自动化"><a href="#（3）自动化" class="headerlink" title="（3）自动化"></a><strong>（3）自动化</strong></h5><p>强大的部署自动化手段确保部署任务的可重复性、减少部署出错的可能性。</p>
<p><img src="https://cdn.jsdelivr.net/gh/FateCause/typoraPic/images/1658016-5fb5bbb6c483c0d9.jpg" alt="img"></p>
<p>与传统开发方法那种大规模的、不频繁的发布（通常以“季度”或“年”为单位）相比，敏捷方法大大提升了发布频率（通常以“天”或“周”为单位）。</p>
<h4 id="实现DevOps需要什么？"><a href="#实现DevOps需要什么？" class="headerlink" title="实现DevOps需要什么？"></a><strong>实现DevOps需要什么？</strong></h4><h5 id="硬性要求：工具上的准备"><a href="#硬性要求：工具上的准备" class="headerlink" title="硬性要求：工具上的准备"></a><strong>硬性要求：工具上的准备</strong></h5><p>上文提到了工具链的打通，那么工具自然就需要做好准备。现将工具类型及对应的不完全列举整理如下：</p>
<p>代码管理（SCM）：<strong>GitHub</strong>、<strong>GitLab</strong>、BitBucket、SubVersion</p>
<p>构建工具：<strong>Ant</strong>、Gradle、<strong>maven</strong></p>
<p>自动部署：Capistrano、CodeDeploy</p>
<p>持续集成（CI）：Bamboo、Hudson、<strong>Jenkins</strong></p>
<p>配置管理：Ansible、Chef、Puppet、SaltStack、ScriptRock GuardRail</p>
<p>容器：<strong>Docker</strong>、LXC、第三方厂商如AWS</p>
<p>编排：<strong>Kubernetes</strong>、Core、Apache Mesos、DC/OS</p>
<p>服务注册与发现：<strong>Zookeeper</strong>、etcd、Consul</p>
<p>脚本语言：<strong>python</strong>、ruby、<strong>shell</strong></p>
<p>日志管理：<strong>ELK</strong>、Logentries</p>
<p>系统监控：Datadog、Graphite、Icinga、Nagios</p>
<p>性能监控：AppDynamics、New Relic、Splunk</p>
<p>压力测试：JMeter、Blaze Meter、loader.io</p>
<p>预警：PagerDuty、pingdom、厂商自带如AWS SNS</p>
<p>HTTP加速器：Varnish</p>
<p>消息总线：ActiveMQ、SQS</p>
<p>应用服务器：<strong>Tomcat</strong>、JBoss</p>
<p>Web服务器：Apache、<strong>Nginx</strong>、IIS</p>
<p>数据库：<strong>MySQL</strong>、Oracle、PostgreSQL等关系型数据库；cassandra、mongoDB、<strong>redis</strong>等NoSQL数据库</p>
<p>项目管理（PM）：Jira、Asana、Taiga、Trello、Basecamp、Pivotal Tracker</p>
<p>在工具的选择上，需要结合公司业务需求和技术团队情况而定。（注：更多关于工具的详细介绍可以参见此文：51 Best DevOps Tools for #DevOps Engineers）</p>
<h5 id="软性需求：文化和人"><a href="#软性需求：文化和人" class="headerlink" title="软性需求：文化和人"></a><strong>软性需求：文化和人</strong></h5><p>DevOps成功与否，公司组织是否利于协作是关键。开发人员和运维人员可以良好沟通互相学习，从而拥有高生产力。并且协作也存在于业务人员与开发人员之间。</p>
<p>出席了2016年伦敦企业级DevOps峰会的ITV公司在2012年就开始落地DevOps，其通用平台主管Clark在接受了InfoQ的采访，在谈及成功时表示，业务人员非常清楚他们希望在最小化可行产品中实现什么，工程师们就按需交付，不做多余工作。</p>
<p>这样，工程师们使用通用的平台（即打通的工具链）得到更好的一致性和更高的质量。此外，DevOps对工程师个人的要求也提高了，很多专家也认为招募到优秀的人才也是一个挑战</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/18/DevOps/DevOps/" data-id="ckk2gq3t40005z8pqeo4u0dn3" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Debezuim/debezuim源码" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/18/Debezuim/debezuim%E6%BA%90%E7%A0%81/" class="article-date">
  <time class="dt-published" datetime="2021-01-18T11:01:37.218Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p> # Kafka Connect<br>## 连接器元数据管理机制<br>Kafka Connect 运行部署<br>  1.单机模式<br>  2.集群模式<br>### 任务偏移量<br>### 任务配置<br>### 任务运行状态<br>## Debezium MySQL连接器元数据管理<br>### 源数据库的当前schema？<br>### 源数据库schema历史<br>## 连接器的topic数据读写</p>
<h4 id="io-debezium-connector-mysql-MySqlConnector"><a href="#io-debezium-connector-mysql-MySqlConnector" class="headerlink" title="io.debezium.connector.mysql.MySqlConnector"></a>io.debezium.connector.mysql.MySqlConnector</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySqlConnector</span> <span class="keyword">extends</span> <span class="title">SourceConnector</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConfigDef <span class="title">config</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MySqlConnectorConfig.configDef();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="io-debezium-connector-mysql-MySqlConnectorConfig"><a href="#io-debezium-connector-mysql-MySqlConnectorConfig" class="headerlink" title="io.debezium.connector.mysql.MySqlConnectorConfig"></a>io.debezium.connector.mysql.MySqlConnectorConfig</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySqlConnectorConfig</span> <span class="keyword">extends</span> <span class="title">RelationalDatabaseConnectorConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	    <span class="function"><span class="keyword">protected</span> <span class="keyword">static</span> ConfigDef <span class="title">configDef</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ConfigDef config = <span class="keyword">new</span> ConfigDef();</span><br><span class="line">        <span class="comment">//调用io.debezium.config.Field的group方法</span></span><br><span class="line">        Field.group(config, <span class="string">&quot;MySQL&quot;</span>, HOSTNAME, PORT, USER, PASSWORD, ON_CONNECT_STATEMENTS, SERVER_NAME, SERVER_ID, SERVER_ID_OFFSET,</span><br><span class="line">                SSL_MODE, SSL_KEYSTORE, SSL_KEYSTORE_PASSWORD, SSL_TRUSTSTORE, SSL_TRUSTSTORE_PASSWORD, JDBC_DRIVER, CommonConnectorConfig.SKIPPED_OPERATIONS);	</span><br><span class="line">        Field.group(config, <span class="string">&quot;History Storage&quot;</span>, KafkaDatabaseHistory.BOOTSTRAP_SERVERS,</span><br><span class="line">                KafkaDatabaseHistory.TOPIC, KafkaDatabaseHistory.RECOVERY_POLL_ATTEMPTS,</span><br><span class="line">                KafkaDatabaseHistory.RECOVERY_POLL_INTERVAL_MS, DATABASE_HISTORY,</span><br><span class="line">                DatabaseHistory.SKIP_UNPARSEABLE_DDL_STATEMENTS, DatabaseHistory.DDL_FILTER,</span><br><span class="line">                DatabaseHistory.STORE_ONLY_MONITORED_TABLES_DDL);</span><br><span class="line">        Field.group(config, <span class="string">&quot;Events&quot;</span>, INCLUDE_SCHEMA_CHANGES, INCLUDE_SQL_QUERY, TABLES_IGNORE_BUILTIN,</span><br><span class="line">                DATABASE_WHITELIST, DATABASE_INCLUDE_LIST, TABLE_WHITELIST, TABLE_INCLUDE_LIST,</span><br><span class="line">                COLUMN_BLACKLIST, COLUMN_EXCLUDE_LIST, COLUMN_INCLUDE_LIST, TABLE_BLACKLIST, TABLE_EXCLUDE_LIST,</span><br><span class="line">                DATABASE_BLACKLIST, DATABASE_EXCLUDE_LIST, MSG_KEY_COLUMNS,</span><br><span class="line">                RelationalDatabaseConnectorConfig.MASK_COLUMN_WITH_HASH,</span><br><span class="line">                RelationalDatabaseConnectorConfig.MASK_COLUMN,</span><br><span class="line">                RelationalDatabaseConnectorConfig.TRUNCATE_COLUMN,</span><br><span class="line">                RelationalDatabaseConnectorConfig.SNAPSHOT_SELECT_STATEMENT_OVERRIDES_BY_TABLE,</span><br><span class="line">                GTID_SOURCE_INCLUDES, GTID_SOURCE_EXCLUDES, GTID_SOURCE_FILTER_DML_EVENTS, GTID_NEW_CHANNEL_POSITION, BUFFER_SIZE_FOR_BINLOG_READER,</span><br><span class="line">                Heartbeat.HEARTBEAT_INTERVAL, Heartbeat.HEARTBEAT_TOPICS_PREFIX, EVENT_DESERIALIZATION_FAILURE_HANDLING_MODE,</span><br><span class="line">                CommonConnectorConfig.EVENT_PROCESSING_FAILURE_HANDLING_MODE, INCONSISTENT_SCHEMA_HANDLING_MODE,</span><br><span class="line">                CommonConnectorConfig.TOMBSTONES_ON_DELETE, CommonConnectorConfig.SOURCE_STRUCT_MAKER_VERSION);</span><br><span class="line">        Field.group(config, <span class="string">&quot;Connector&quot;</span>, CONNECTION_TIMEOUT_MS, KEEP_ALIVE, KEEP_ALIVE_INTERVAL_MS, CommonConnectorConfig.MAX_QUEUE_SIZE,</span><br><span class="line">                CommonConnectorConfig.MAX_BATCH_SIZE, CommonConnectorConfig.POLL_INTERVAL_MS,</span><br><span class="line">                SNAPSHOT_MODE, SNAPSHOT_LOCKING_MODE, SNAPSHOT_NEW_TABLES, SNAPSHOT_EVENTS_AS_INSERTS, TIME_PRECISION_MODE, DECIMAL_HANDLING_MODE,</span><br><span class="line">                BIGINT_UNSIGNED_HANDLING_MODE, SNAPSHOT_DELAY_MS, SNAPSHOT_FETCH_SIZE, ENABLE_TIME_ADJUSTER, BINARY_HANDLING_MODE);</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="io-debezium-config-Field"><a href="#io-debezium-config-Field" class="headerlink" title="io.debezium.config.Field"></a>io.debezium.config.Field</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Field</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigDef <span class="title">group</span><span class="params">(ConfigDef configDef, String groupName, Field... fields)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (configDef != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (groupName != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i != fields.length; ++i) &#123;</span><br><span class="line">                    Field f = fields[i];</span><br><span class="line">                    <span class="comment">//调用org.apache.kafka.common.config.ConfigDef的define方法,将Field的key存入ConfigDef的map容器configKeys中</span></span><br><span class="line">                    configDef.define(f.name(), f.type(), f.defaultValue(), <span class="keyword">null</span>, f.importance(), f.description(),</span><br><span class="line">                            groupName, i + <span class="number">1</span>, f.width(), f.displayName(), f.dependents(), <span class="keyword">null</span>);	</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i != fields.length; ++i) &#123;</span><br><span class="line">                    Field f = fields[i];</span><br><span class="line">                    configDef.define(f.name(), f.type(), f.defaultValue(), <span class="keyword">null</span>, f.importance(), f.description(),</span><br><span class="line">                            <span class="keyword">null</span>, <span class="number">1</span>, f.width(), f.displayName(), f.dependents(), <span class="keyword">null</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> configDef;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="org-apache-kafka-common-config-ConfigDef"><a href="#org-apache-kafka-common-config-ConfigDef" class="headerlink" title="org.apache.kafka.common.config.ConfigDef"></a>org.apache.kafka.common.config.ConfigDef</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigDef</span> </span>&#123;</span><br><span class="line">	    <span class="function"><span class="keyword">public</span> ConfigDef <span class="title">define</span><span class="params">(ConfigDef.ConfigKey key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.configKeys.containsKey(key.name)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ConfigException(<span class="string">&quot;Configuration &quot;</span> + key.name + <span class="string">&quot; is defined twice.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (key.group != <span class="keyword">null</span> &amp;&amp; !<span class="keyword">this</span>.groups.contains(key.group)) &#123;</span><br><span class="line">                <span class="keyword">this</span>.groups.add(key.group);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.configKeys.put(key.name, key);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="io-debezium-connector-mysql-MySqlConnectorTask"><a href="#io-debezium-connector-mysql-MySqlConnectorTask" class="headerlink" title="io.debezium.connector.mysql.MySqlConnectorTask"></a>io.debezium.connector.mysql.MySqlConnectorTask</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ChangeEventSourceCoordinator <span class="title">start</span><span class="params">(Configuration config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String serverName = config.getString(MySqlConnectorConfig.SERVER_NAME);</span><br><span class="line">        PreviousContext prevLoggingContext = LoggingContext.forConnector(Module.contextName(), serverName, <span class="string">&quot;task&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Get the offsets for our partition ...</span></span><br><span class="line">            <span class="keyword">boolean</span> startWithSnapshot = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">boolean</span> snapshotEventsAsInserts = config.getBoolean(MySqlConnectorConfig.SNAPSHOT_EVENTS_AS_INSERTS);</span><br><span class="line">            Map&lt;String, String&gt; partition = Collect.hashMapOf(SourceInfo.SERVER_PARTITION_KEY, serverName); <span class="comment">//初始化分区map</span></span><br><span class="line">            Map&lt;String, ?&gt; offsets = getRestartOffset(context.offsetStorageReader().offset(partition)); <span class="comment">//初始化以&quot;RESTART_&quot;开头的偏移量</span></span><br><span class="line">            <span class="keyword">final</span> SourceInfo source;</span><br><span class="line">            <span class="keyword">if</span> (offsets != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Filters filters = SourceInfo.offsetsHaveFilterInfo(offsets) ? getOldFilters(offsets, config) : getAllFilters(config);   <span class="comment">//初始化数据库和表过滤器</span></span><br><span class="line">                <span class="keyword">this</span>.taskContext = createAndStartTaskContext(config, filters);  <span class="comment">//调用初始化和开始任务上下文容器方法</span></span><br><span class="line">                <span class="keyword">this</span>.connectionContext = taskContext.getConnectionContext();    <span class="comment">//获取MySqlJdbcContext连接上下文</span></span><br><span class="line">                source = taskContext.source();  <span class="comment">//获取SourceInfo</span></span><br><span class="line">                <span class="comment">// Set the position in our source info ...</span></span><br><span class="line">                source.setOffset(offsets);  <span class="comment">//设置offset偏移量</span></span><br><span class="line">                logger.info(<span class="string">&quot;Found existing offset: &#123;&#125;&quot;</span>, offsets);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// First check if db history is available</span></span><br><span class="line">                <span class="keyword">if</span> (!taskContext.historyExists()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (taskContext.isSchemaOnlyRecoverySnapshot()) &#123;</span><br><span class="line">                        startWithSnapshot = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// But check to see if the server still has those binlog coordinates ...</span></span><br><span class="line">                        <span class="keyword">if</span> (!isBinlogAvailable()) &#123;</span><br><span class="line">                            String msg = <span class="string">&quot;The connector is trying to read binlog starting at &quot;</span> + source + <span class="string">&quot;, but this is no longer &quot;</span></span><br><span class="line">                                    + <span class="string">&quot;available on the server. Reconfigure the connector to use a snapshot when needed.&quot;</span>;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(msg);</span><br><span class="line">                        &#125;</span><br><span class="line">                        logger.info(<span class="string">&quot;The db-history topic is missing but we are in &#123;&#125; snapshot mode. &quot;</span> +</span><br><span class="line">                                <span class="string">&quot;Attempting to snapshot the current schema and then begin reading the binlog from the last recorded offset.&quot;</span>,</span><br><span class="line">                                SnapshotMode.SCHEMA_ONLY_RECOVERY);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        String msg = <span class="string">&quot;The db history topic is missing. You may attempt to recover it by reconfiguring the connector to &quot;</span></span><br><span class="line">                                + SnapshotMode.SCHEMA_ONLY_RECOVERY;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(msg);</span><br><span class="line">                    &#125;</span><br><span class="line">                    taskContext.initializeHistoryStorage();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Before anything else, recover the database history to the specified binlog coordinates ...</span></span><br><span class="line">                    taskContext.loadHistory(source);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (source.isSnapshotInEffect()) &#123;</span><br><span class="line">                        <span class="comment">// The last offset was an incomplete snapshot that we cannot recover from...</span></span><br><span class="line">                        <span class="keyword">if</span> (taskContext.isSnapshotNeverAllowed()) &#123;</span><br><span class="line">                            <span class="comment">// No snapshots are allowed</span></span><br><span class="line">                            String msg = <span class="string">&quot;The connector previously stopped while taking a snapshot, but now the connector is configured &quot;</span></span><br><span class="line">                                    + <span class="string">&quot;to never allow snapshots. Reconfigure the connector to use snapshots initially or when needed.&quot;</span>;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(msg);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// Otherwise, restart a new snapshot ...</span></span><br><span class="line">                        startWithSnapshot = <span class="keyword">true</span>;</span><br><span class="line">                        logger.info(<span class="string">&quot;Prior execution was an incomplete snapshot, so starting new snapshot&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// No snapshot was in effect, so we should just start reading from the binlog ...</span></span><br><span class="line">                        startWithSnapshot = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// But check to see if the server still has those binlog coordinates ...</span></span><br><span class="line">                        <span class="keyword">if</span> (!isBinlogAvailable()) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (!taskContext.isSnapshotAllowedWhenNeeded()) &#123;</span><br><span class="line">                                String msg = <span class="string">&quot;The connector is trying to read binlog starting at &quot;</span> + source + <span class="string">&quot;, but this is no longer &quot;</span></span><br><span class="line">                                        + <span class="string">&quot;available on the server. Reconfigure the connector to use a snapshot when needed.&quot;</span>;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(msg);</span><br><span class="line">                            &#125;</span><br><span class="line">                            startWithSnapshot = <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// We have no recorded offsets ...</span></span><br><span class="line">                <span class="keyword">this</span>.taskContext = createAndStartTaskContext(config, getAllFilters(config));</span><br><span class="line">                taskContext.initializeHistoryStorage();</span><br><span class="line">                <span class="keyword">this</span>.connectionContext = taskContext.getConnectionContext();</span><br><span class="line">                source = taskContext.source();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (taskContext.isSnapshotNeverAllowed()) &#123;</span><br><span class="line">                    <span class="comment">// We&#x27;re not allowed to take a snapshot, so instead we have to assume that the binlog contains the</span></span><br><span class="line">                    <span class="comment">// full history of the database.</span></span><br><span class="line">                    logger.info(<span class="string">&quot;Found no existing offset and snapshots disallowed, so starting at beginning of binlog&quot;</span>);</span><br><span class="line">                    source.setBinlogStartPoint(<span class="string">&quot;&quot;</span>, <span class="number">0L</span>); <span class="comment">// start from the beginning of the binlog</span></span><br><span class="line">                    taskContext.initializeHistory();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Look to see what the first available binlog file is called, and whether it looks like binlog files have</span></span><br><span class="line">                    <span class="comment">// been purged. If so, then output a warning ...</span></span><br><span class="line">                    String earliestBinlogFilename = earliestBinlogFilename();</span><br><span class="line">                    <span class="keyword">if</span> (earliestBinlogFilename == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        logger.warn(<span class="string">&quot;No binlog appears to be available. Ensure that the MySQL row-level binlog is enabled.&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (!earliestBinlogFilename.endsWith(<span class="string">&quot;00001&quot;</span>)) &#123;</span><br><span class="line">                        logger.warn(<span class="string">&quot;It is possible the server has purged some binlogs. If this is the case, then using snapshot mode may be required.&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// We are allowed to use snapshots, and that is the best way to start ...</span></span><br><span class="line">                    startWithSnapshot = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="comment">// The snapshot will determine if GTIDs are set</span></span><br><span class="line">                    logger.info(<span class="string">&quot;Found no existing offset, so preparing to perform a snapshot&quot;</span>);</span><br><span class="line">                    <span class="comment">// The snapshot will also initialize history ...</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!startWithSnapshot &amp;&amp; source.gtidSet() == <span class="keyword">null</span> &amp;&amp; connectionContext.isGtidModeEnabled()) &#123;</span><br><span class="line">                <span class="comment">// The snapshot will properly determine the GTID set, but we&#x27;re not starting with a snapshot and GTIDs were not</span></span><br><span class="line">                <span class="comment">// previously used but the MySQL server has them enabled ...</span></span><br><span class="line">                source.setCompletedGtidSet(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check whether the row-level binlog is enabled ...</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">boolean</span> binlogFormatRow = isBinlogFormatRow();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">boolean</span> binlogRowImageFull = isBinlogRowImageFull();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">boolean</span> rowBinlogEnabled = binlogFormatRow &amp;&amp; binlogRowImageFull;</span><br><span class="line"></span><br><span class="line">            ChainedReader.Builder chainedReaderBuilder = <span class="keyword">new</span> ChainedReader.Builder();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Set up the readers, with a callback to `completeReaders` so that we know when it is finished ...</span></span><br><span class="line">            <span class="keyword">if</span> (startWithSnapshot) &#123;</span><br><span class="line">                <span class="comment">// We&#x27;re supposed to start with a snapshot, so set that up ...</span></span><br><span class="line">                SnapshotReader snapshotReader = <span class="keyword">new</span> SnapshotReader(<span class="string">&quot;snapshot&quot;</span>, taskContext);</span><br><span class="line">                <span class="keyword">if</span> (snapshotEventsAsInserts) &#123;</span><br><span class="line">                    snapshotReader.generateInsertEvents();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!taskContext.getConnectorConfig().getSnapshotDelay().isZero()) &#123;</span><br><span class="line">                    <span class="comment">// Adding a timed blocking reader to delay the snapshot, can help to avoid initial rebalancing interruptions</span></span><br><span class="line">                    chainedReaderBuilder.addReader(<span class="keyword">new</span> TimedBlockingReader(<span class="string">&quot;timed-blocker&quot;</span>, taskContext.getConnectorConfig().getSnapshotDelay()));</span><br><span class="line">                &#125;</span><br><span class="line">                chainedReaderBuilder.addReader(snapshotReader);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (taskContext.isInitialSnapshotOnly()) &#123;</span><br><span class="line">                    logger.warn(<span class="string">&quot;This connector will only perform a snapshot, and will stop after that completes.&quot;</span>);</span><br><span class="line">                    chainedReaderBuilder.addReader(<span class="keyword">new</span> BlockingReader(<span class="string">&quot;blocker&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;Connector has completed all of its work but will continue in the running state. It can be shut down at any time.&quot;</span>));</span><br><span class="line">                    chainedReaderBuilder</span><br><span class="line">                            .completionMessage(<span class="string">&quot;Connector configured to only perform snapshot, and snapshot completed successfully. Connector will terminate.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!rowBinlogEnabled) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!binlogFormatRow) &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(<span class="string">&quot;The MySQL server is not configured to use a ROW binlog_format, which is &quot;</span></span><br><span class="line">                                    + <span class="string">&quot;required for this connector to work properly. Change the MySQL configuration to use a &quot;</span></span><br><span class="line">                                    + <span class="string">&quot;binlog_format=ROW and restart the connector.&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(<span class="string">&quot;The MySQL server is not configured to use a FULL binlog_row_image, which is &quot;</span></span><br><span class="line">                                    + <span class="string">&quot;required for this connector to work properly. Change the MySQL configuration to use a &quot;</span></span><br><span class="line">                                    + <span class="string">&quot;binlog_row_image=FULL and restart the connector.&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    BinlogReader binlogReader = <span class="keyword">new</span> BinlogReader(<span class="string">&quot;binlog&quot;</span>, taskContext, <span class="keyword">null</span>);</span><br><span class="line">                    chainedReaderBuilder.addReader(binlogReader);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                source.maybeSetFilterDataFromConfig(config);</span><br><span class="line">                <span class="keyword">if</span> (!rowBinlogEnabled) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(</span><br><span class="line">                            <span class="string">&quot;The MySQL server does not appear to be using a full row-level binlog, which is required for this connector to work properly. Enable this mode and restart the connector.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// if there are new tables</span></span><br><span class="line">                <span class="keyword">if</span> (newTablesInConfig()) &#123;</span><br><span class="line">                    <span class="comment">// and we are configured to run a parallel snapshot</span></span><br><span class="line">                    <span class="keyword">if</span> (taskContext.getConnectorConfig().getSnapshotNewTables() == MySqlConnectorConfig.SnapshotNewTables.PARALLEL) &#123;</span><br><span class="line">                        ServerIdGenerator serverIdGenerator = <span class="keyword">new</span> ServerIdGenerator(config.getLong(MySqlConnectorConfig.SERVER_ID),</span><br><span class="line">                                config.getLong(MySqlConnectorConfig.SERVER_ID_OFFSET));</span><br><span class="line">                        ParallelSnapshotReader parallelSnapshotReader = <span class="keyword">new</span> ParallelSnapshotReader(config,</span><br><span class="line">                                taskContext,</span><br><span class="line">                                getNewFilters(offsets, config),</span><br><span class="line">                                serverIdGenerator);</span><br><span class="line"></span><br><span class="line">                        MySqlTaskContext unifiedTaskContext = createAndStartTaskContext(config, getAllFilters(config));</span><br><span class="line">                        <span class="comment">// we aren&#x27;t completing a snapshot, but we need to make sure the &quot;snapshot&quot; flag is false for this new context.</span></span><br><span class="line">                        unifiedTaskContext.source().completeSnapshot();</span><br><span class="line">                        BinlogReader unifiedBinlogReader = <span class="keyword">new</span> BinlogReader(<span class="string">&quot;binlog&quot;</span>,</span><br><span class="line">                                unifiedTaskContext,</span><br><span class="line">                                <span class="keyword">null</span>,</span><br><span class="line">                                serverIdGenerator.getConfiguredServerId());</span><br><span class="line">                        ReconcilingBinlogReader reconcilingBinlogReader = parallelSnapshotReader.createReconcilingBinlogReader(unifiedBinlogReader);</span><br><span class="line"></span><br><span class="line">                        chainedReaderBuilder.addReader(parallelSnapshotReader);</span><br><span class="line">                        chainedReaderBuilder.addReader(reconcilingBinlogReader);</span><br><span class="line">                        chainedReaderBuilder.addReader(unifiedBinlogReader);</span><br><span class="line"></span><br><span class="line">                        unifiedBinlogReader.uponCompletion(unifiedTaskContext::shutdown);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// We&#x27;re going to start by reading the binlog ...</span></span><br><span class="line">                    BinlogReader binlogReader = <span class="keyword">new</span> BinlogReader(<span class="string">&quot;binlog&quot;</span>, taskContext, <span class="keyword">null</span>);</span><br><span class="line">                    chainedReaderBuilder.addReader(binlogReader);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            readers = chainedReaderBuilder.build();</span><br><span class="line">            readers.uponCompletion(<span class="keyword">this</span>::completeReaders);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// And finally initialize and start the chain of readers ...</span></span><br><span class="line">            <span class="keyword">this</span>.readers.initialize();</span><br><span class="line">            <span class="keyword">this</span>.readers.start();	<span class="comment">//调用io.debezium.connector.mysql.ChainedReader的start方法</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            <span class="comment">// If we don&#x27;t complete startup, then Kafka Connect will not attempt to stop the connector. So if we</span></span><br><span class="line">            <span class="comment">// run into a problem, we have to stop ourselves ...</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stop();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Throwable s) &#123;</span><br><span class="line">                <span class="comment">// Log, but don&#x27;t propagate ...</span></span><br><span class="line">                logger.error(<span class="string">&quot;Failed to start the connector (see other exception), but got this error while cleaning up&quot;</span>, s);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> InterruptedException) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(<span class="string">&quot;Interrupted while starting the connector&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ConnectException) &#123;</span><br><span class="line">                <span class="keyword">throw</span> (ConnectException) e;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            prevLoggingContext.restore();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> MySqlTaskContext <span class="title">createAndStartTaskContext</span><span class="params">(Configuration config,Filters filters)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//调用初始化任务io.debezium.connector.mysql.MySqlTaskContext上下文容器方法</span></span><br><span class="line">        MySqlTaskContext taskContext = <span class="keyword">new</span> MySqlTaskContext(config, filters);   </span><br><span class="line">            </span><br><span class="line">         <span class="comment">//启动任务上下文容器</span></span><br><span class="line">        taskContext.start();   </span><br><span class="line">        <span class="keyword">return</span> taskContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="io-debezium-connector-mysql-MySqlTaskContext"><a href="#io-debezium-connector-mysql-MySqlTaskContext" class="headerlink" title="io.debezium.connector.mysql.MySqlTaskContext"></a>io.debezium.connector.mysql.MySqlTaskContext</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MySqlTaskContext</span> <span class="keyword">extends</span> <span class="title">CdcSourceTaskContext</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MySqlTaskContext</span><span class="params">(Configuration config, Filters filters, Boolean tableIdCaseInsensitive, Map&lt;String, ?&gt; restartOffset)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(Module.contextName(), config.getString(MySqlConnectorConfig.SERVER_NAME), Collections::emptyList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.config = config;</span><br><span class="line">        <span class="keyword">this</span>.connectorConfig = <span class="keyword">new</span> MySqlConnectorConfig(config);	<span class="comment">//实例化mysql连接配置</span></span><br><span class="line">        <span class="keyword">this</span>.connectionContext = <span class="keyword">new</span> MySqlJdbcContext(connectorConfig);	<span class="comment">//实例化mysql连接上下文容器</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set up the topic selector ...</span></span><br><span class="line">        <span class="keyword">this</span>.topicSelector = MySqlTopicSelector.defaultSelector(connectorConfig.getLogicalName(), connectorConfig.getHeartbeatTopicsPrefix());	<span class="comment">//设置kafka主题选择器</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set up the source information ...</span></span><br><span class="line">        <span class="keyword">this</span>.source = <span class="keyword">new</span> SourceInfo(connectorConfig);	<span class="comment">//设置原信息</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set up the GTID filter ...</span></span><br><span class="line">        String gtidSetIncludes = config.getString(MySqlConnectorConfig.GTID_SOURCE_INCLUDES);</span><br><span class="line">        String gtidSetExcludes = config.getString(MySqlConnectorConfig.GTID_SOURCE_EXCLUDES);</span><br><span class="line">        <span class="keyword">this</span>.gtidSourceFilter = gtidSetIncludes != <span class="keyword">null</span> ? Predicates.includesUuids(gtidSetIncludes)</span><br><span class="line">                : (gtidSetExcludes != <span class="keyword">null</span> ? Predicates.excludesUuids(gtidSetExcludes) : <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (tableIdCaseInsensitive == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.tableIdCaseInsensitive = !<span class="string">&quot;0&quot;</span>.equals(connectionContext.readMySqlSystemVariables().get(MySqlSystemVariables.LOWER_CASE_TABLE_NAMES));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.tableIdCaseInsensitive = tableIdCaseInsensitive;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set up the MySQL schema ...</span></span><br><span class="line">        <span class="keyword">this</span>.dbSchema = <span class="keyword">new</span> MySqlSchema(connectorConfig, <span class="keyword">this</span>.gtidSourceFilter, <span class="keyword">this</span>.tableIdCaseInsensitive, topicSelector, filters);	<span class="comment">//实例化mysql schema</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set up the record processor ...</span></span><br><span class="line">        <span class="keyword">this</span>.recordProcessor = <span class="keyword">new</span> RecordMakers(dbSchema, source, topicSelector, connectorConfig.isEmitTombstoneOnDelete(), restartOffset);	<span class="comment">//实例化记录创建器</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set up the DDL filter</span></span><br><span class="line">        <span class="keyword">final</span> String ddlFilter = config.getString(DatabaseHistory.DDL_FILTER);</span><br><span class="line">        <span class="keyword">this</span>.ddlFilter = (ddlFilter != <span class="keyword">null</span>) ? Predicates.includes(ddlFilter) : (x -&gt; <span class="keyword">false</span>);	<span class="comment">//设置ddl过滤器</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        connectionContext.start();	<span class="comment">//io.debezium.connector.mysql.MySqlJdbcContext启动</span></span><br><span class="line">        <span class="comment">// Start the MySQL database history, which simply starts up resources but does not recover the history to a specific point</span></span><br><span class="line">        dbSchema().start();	<span class="comment">//io.debezium.connector.mysql.MySqlSchema启动</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="io-debezium-connector-mysql-MySqlJdbcContext"><a href="#io-debezium-connector-mysql-MySqlJdbcContext" class="headerlink" title="io.debezium.connector.mysql.MySqlJdbcContext"></a>io.debezium.connector.mysql.MySqlJdbcContext</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySqlJdbcContext</span> <span class="keyword">implements</span> <span class="title">AutoCloseable</span> </span>&#123;</span><br><span class="line">    <span class="comment">//调用开始方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sslModeEnabled()) &#123;</span><br><span class="line">            originalSystemProperties.clear();</span><br><span class="line">            <span class="comment">// Set the System properties for SSL for the MySQL driver ...</span></span><br><span class="line">            setSystemProperty(<span class="string">&quot;javax.net.ssl.keyStore&quot;</span>, MySqlConnectorConfig.SSL_KEYSTORE, <span class="keyword">true</span>);</span><br><span class="line">            setSystemProperty(<span class="string">&quot;javax.net.ssl.keyStorePassword&quot;</span>, MySqlConnectorConfig.SSL_KEYSTORE_PASSWORD, <span class="keyword">false</span>);</span><br><span class="line">            setSystemProperty(<span class="string">&quot;javax.net.ssl.trustStore&quot;</span>, MySqlConnectorConfig.SSL_TRUSTSTORE, <span class="keyword">true</span>);</span><br><span class="line">            setSystemProperty(<span class="string">&quot;javax.net.ssl.trustStorePassword&quot;</span>, MySqlConnectorConfig.SSL_TRUSTSTORE_PASSWORD, <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="io-debezium-connector-mysql-MySqlSchema"><a href="#io-debezium-connector-mysql-MySqlSchema" class="headerlink" title="io.debezium.connector.mysql.MySqlSchema"></a>io.debezium.connector.mysql.MySqlSchema</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySqlSchema</span> <span class="keyword">extends</span> <span class="title">RelationalDatabaseSchema</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dbHistory.start();	<span class="comment">// io.debezium.relational.history.KafkaDatabaseHistory启动</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="io-debezium-relational-history-KafkaDatabaseHistory"><a href="#io-debezium-relational-history-KafkaDatabaseHistory" class="headerlink" title="io.debezium.relational.history.KafkaDatabaseHistory"></a>io.debezium.relational.history.KafkaDatabaseHistory</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaDatabaseHistory</span> <span class="keyword">extends</span> <span class="title">AbstractDatabaseHistory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.start();	<span class="comment">//调用父类io.debezium.relational.history.AbstractDatabaseHistory的start方法</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.producer == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.producer = <span class="keyword">new</span> KafkaProducer&lt;&gt;(<span class="keyword">this</span>.producerConfig.asProperties());	<span class="comment">//创建kafka消息生产者</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="io-debezium-relational-history-AbstractDatabaseHistory"><a href="#io-debezium-relational-history-AbstractDatabaseHistory" class="headerlink" title="io.debezium.relational.history.AbstractDatabaseHistory"></a>io.debezium.relational.history.AbstractDatabaseHistory</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractDatabaseHistory</span> <span class="keyword">implements</span> <span class="title">DatabaseHistory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        listener.started();	<span class="comment">//调用io.debezium.relational.history.DatabaseHistoryMetrics的启动方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="io-debezium-relational-history-DatabaseHistoryMetrics"><a href="#io-debezium-relational-history-DatabaseHistoryMetrics" class="headerlink" title="io.debezium.relational.history.DatabaseHistoryMetrics"></a>io.debezium.relational.history.DatabaseHistoryMetrics</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseHistoryMetrics</span> <span class="keyword">extends</span> <span class="title">Metrics</span> <span class="keyword">implements</span> <span class="title">DatabaseHistoryListener</span>, <span class="title">DatabaseHistoryMXBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">enum</span> <span class="title">DatabaseHistoryStatus</span> </span>&#123;</span><br><span class="line">        STOPPED,</span><br><span class="line">        RECOVERING,</span><br><span class="line">        RUNNING</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">started</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        status = DatabaseHistoryStatus.RUNNING;	<span class="comment">//设置DatabaseHistoryMetrics的状态为RUNNING</span></span><br><span class="line">        register(LOGGER);	</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="io-debezium-connector-mysql-BinlogReader"><a href="#io-debezium-connector-mysql-BinlogReader" class="headerlink" title="io.debezium.connector.mysql.BinlogReader"></a>io.debezium.connector.mysql.BinlogReader</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinlogReader</span> <span class="keyword">extends</span> <span class="title">AbstractReader</span> </span>&#123;</span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="title">BinlogReader</span><span class="params">(String name, MySqlTaskContext context, HaltingPredicate acceptAndContinue, <span class="keyword">long</span> serverId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name, context, acceptAndContinue);</span><br><span class="line"></span><br><span class="line">        connectionContext = context.getConnectionContext();</span><br><span class="line">        source = context.source();</span><br><span class="line">        recordMakers = context.makeRecord();</span><br><span class="line">        recordSchemaChangesInSourceRecords = context.includeSchemaChangeRecords();</span><br><span class="line">        clock = context.getClock();</span><br><span class="line">        eventDeserializationFailureHandlingMode = connectionContext.eventProcessingFailureHandlingMode();</span><br><span class="line">        inconsistentSchemaHandlingMode = connectionContext.inconsistentSchemaHandlingMode();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use exponential delay to log the progress frequently at first, but the quickly tapering off to once an hour...</span></span><br><span class="line">        pollOutputDelay = ElapsedTimeStrategy.exponential(clock, INITIAL_POLL_PERIOD_IN_MILLIS, MAX_POLL_PERIOD_IN_MILLIS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set up the log reader ...</span></span><br><span class="line">        client = <span class="keyword">new</span> BinaryLogClient(connectionContext.hostname(), connectionContext.port(), connectionContext.username(), connectionContext.password());</span><br><span class="line">        <span class="comment">// BinaryLogClient will overwrite thread names later</span></span><br><span class="line">        client.setThreadFactory(</span><br><span class="line">                Threads.threadFactory(MySqlConnector.class, context.getConnectorConfig().getLogicalName(), <span class="string">&quot;binlog-client&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>,</span><br><span class="line">                        x -&gt; binaryLogClientThreads.put(x.getName(), x)));</span><br><span class="line">        client.setServerId(serverId);</span><br><span class="line">        client.setSSLMode(sslModeFor(connectionContext.sslMode()));</span><br><span class="line">        <span class="keyword">if</span> (connectionContext.sslModeEnabled()) &#123;</span><br><span class="line">            SSLSocketFactory sslSocketFactory = getBinlogSslSocketFactory(connectionContext);</span><br><span class="line">            <span class="keyword">if</span> (sslSocketFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">                client.setSslSocketFactory(sslSocketFactory);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Configuration configuration = context.config();</span><br><span class="line">        client.setKeepAlive(configuration.getBoolean(MySqlConnectorConfig.KEEP_ALIVE));</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> keepAliveInterval = configuration.getLong(MySqlConnectorConfig.KEEP_ALIVE_INTERVAL_MS);</span><br><span class="line">        client.setKeepAliveInterval(keepAliveInterval);</span><br><span class="line">        <span class="comment">// Considering heartbeatInterval should be less than keepAliveInterval, we use the heartbeatIntervalFactor</span></span><br><span class="line">        <span class="comment">// multiply by keepAliveInterval and set the result value to heartbeatInterval.The default value of heartbeatIntervalFactor</span></span><br><span class="line">        <span class="comment">// is 0.8, and we believe the left time (0.2 * keepAliveInterval) is enough to process the packet received from the MySQL server.</span></span><br><span class="line">        client.setHeartbeatInterval((<span class="keyword">long</span>) (keepAliveInterval * heartbeatIntervalFactor));</span><br><span class="line">        client.registerEventListener(context.bufferSizeForBinlogReader() == <span class="number">0</span></span><br><span class="line">                ? <span class="keyword">this</span>::handleEvent</span><br><span class="line">                : (<span class="keyword">new</span> EventBuffer(context.bufferSizeForBinlogReader(), <span class="keyword">this</span>))::add);	<span class="comment">//注册事件处理监听器</span></span><br><span class="line"></span><br><span class="line">        client.registerLifecycleListener(<span class="keyword">new</span> ReaderThreadLifecycleListener());</span><br><span class="line">        client.registerEventListener(<span class="keyword">this</span>::onEvent);</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            client.registerEventListener(<span class="keyword">this</span>::logEvent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> filterDmlEventsByGtidSource = configuration.getBoolean(MySqlConnectorConfig.GTID_SOURCE_FILTER_DML_EVENTS);</span><br><span class="line">        gtidDmlSourceFilter = filterDmlEventsByGtidSource ? context.gtidSourceFilter() : <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set up the event deserializer with additional type(s) ...</span></span><br><span class="line">        <span class="keyword">final</span> Map&lt;Long, TableMapEventData&gt; tableMapEventByTableId = <span class="keyword">new</span> HashMap&lt;Long, TableMapEventData&gt;();</span><br><span class="line">        EventDeserializer eventDeserializer = <span class="keyword">new</span> EventDeserializer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Event <span class="title">nextEvent</span><span class="params">(ByteArrayInputStream inputStream)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// Delegate to the superclass ...</span></span><br><span class="line">                    Event event = <span class="keyword">super</span>.nextEvent(inputStream);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// We have to record the most recent TableMapEventData for each table number for our custom deserializers ...</span></span><br><span class="line">                    <span class="keyword">if</span> (event.getHeader().getEventType() == EventType.TABLE_MAP) &#123;</span><br><span class="line">                        TableMapEventData tableMapEvent = event.getData();</span><br><span class="line">                        tableMapEventByTableId.put(tableMapEvent.getTableId(), tableMapEvent);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> event;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// DBZ-217 In case an event couldn&#x27;t be read we create a pseudo-event for the sake of logging</span></span><br><span class="line">                <span class="keyword">catch</span> (EventDataDeserializationException edde) &#123;</span><br><span class="line">                    EventHeaderV4 header = <span class="keyword">new</span> EventHeaderV4();</span><br><span class="line">                    header.setEventType(EventType.INCIDENT);</span><br><span class="line">                    header.setTimestamp(edde.getEventHeader().getTimestamp());</span><br><span class="line">                    header.setServerId(edde.getEventHeader().getServerId());</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (edde.getEventHeader() <span class="keyword">instanceof</span> EventHeaderV4) &#123;</span><br><span class="line">                        header.setEventLength(((EventHeaderV4) edde.getEventHeader()).getEventLength());</span><br><span class="line">                        header.setNextPosition(((EventHeaderV4) edde.getEventHeader()).getNextPosition());</span><br><span class="line">                        header.setFlags(((EventHeaderV4) edde.getEventHeader()).getFlags());</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    EventData data = <span class="keyword">new</span> EventDataDeserializationExceptionData(edde);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> Event(header, data);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add our custom deserializers ...</span></span><br><span class="line">        eventDeserializer.setEventDataDeserializer(EventType.STOP, <span class="keyword">new</span> StopEventDataDeserializer());</span><br><span class="line">        eventDeserializer.setEventDataDeserializer(EventType.GTID, <span class="keyword">new</span> GtidEventDataDeserializer());</span><br><span class="line">        eventDeserializer.setEventDataDeserializer(EventType.WRITE_ROWS,</span><br><span class="line">                <span class="keyword">new</span> RowDeserializers.WriteRowsDeserializer(tableMapEventByTableId));</span><br><span class="line">        eventDeserializer.setEventDataDeserializer(EventType.UPDATE_ROWS,</span><br><span class="line">                <span class="keyword">new</span> RowDeserializers.UpdateRowsDeserializer(tableMapEventByTableId));</span><br><span class="line">        eventDeserializer.setEventDataDeserializer(EventType.DELETE_ROWS,</span><br><span class="line">                <span class="keyword">new</span> RowDeserializers.DeleteRowsDeserializer(tableMapEventByTableId));</span><br><span class="line">        eventDeserializer.setEventDataDeserializer(EventType.EXT_WRITE_ROWS,</span><br><span class="line">                <span class="keyword">new</span> RowDeserializers.WriteRowsDeserializer(</span><br><span class="line">                        tableMapEventByTableId).setMayContainExtraInformation(<span class="keyword">true</span>));</span><br><span class="line">        eventDeserializer.setEventDataDeserializer(EventType.EXT_UPDATE_ROWS,</span><br><span class="line">                <span class="keyword">new</span> RowDeserializers.UpdateRowsDeserializer(</span><br><span class="line">                        tableMapEventByTableId).setMayContainExtraInformation(<span class="keyword">true</span>));</span><br><span class="line">        eventDeserializer.setEventDataDeserializer(EventType.EXT_DELETE_ROWS,</span><br><span class="line">                <span class="keyword">new</span> RowDeserializers.DeleteRowsDeserializer(</span><br><span class="line">                        tableMapEventByTableId).setMayContainExtraInformation(<span class="keyword">true</span>));</span><br><span class="line">        client.setEventDeserializer(eventDeserializer);	<span class="comment">//设置各种事件解析器</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set up for JMX ...</span></span><br><span class="line">        metrics = <span class="keyword">new</span> BinlogReaderMetrics(client, context, name, changeEventQueueMetrics);</span><br><span class="line">        heartbeat = Heartbeat.create(configuration.getDuration(Heartbeat.HEARTBEAT_INTERVAL, ChronoUnit.MILLIS),</span><br><span class="line">                context.topicSelector().getHeartbeatTopic(), context.getConnectorConfig().getLogicalName());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        context.dbSchema().assureNonEmptySchema();</span><br><span class="line">        Set&lt;Operation&gt; skippedOperations = context.getConnectorConfig().getSkippedOps();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register our event handlers ...</span></span><br><span class="line">        eventHandlers.put(EventType.STOP, <span class="keyword">this</span>::handleServerStop);</span><br><span class="line">        eventHandlers.put(EventType.HEARTBEAT, <span class="keyword">this</span>::handleServerHeartbeat);</span><br><span class="line">        eventHandlers.put(EventType.INCIDENT, <span class="keyword">this</span>::handleServerIncident);</span><br><span class="line">        eventHandlers.put(EventType.ROTATE, <span class="keyword">this</span>::handleRotateLogsEvent);</span><br><span class="line">        eventHandlers.put(EventType.TABLE_MAP, <span class="keyword">this</span>::handleUpdateTableMetadata);</span><br><span class="line">        eventHandlers.put(EventType.QUERY, <span class="keyword">this</span>::handleQueryEvent);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!skippedOperations.contains(Operation.CREATE)) &#123;</span><br><span class="line">            eventHandlers.put(EventType.WRITE_ROWS, <span class="keyword">this</span>::handleInsert);</span><br><span class="line">            eventHandlers.put(EventType.EXT_WRITE_ROWS, <span class="keyword">this</span>::handleInsert);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!skippedOperations.contains(Operation.UPDATE)) &#123;</span><br><span class="line">            eventHandlers.put(EventType.UPDATE_ROWS, <span class="keyword">this</span>::handleUpdate);</span><br><span class="line">            eventHandlers.put(EventType.EXT_UPDATE_ROWS, <span class="keyword">this</span>::handleUpdate);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!skippedOperations.contains(Operation.DELETE)) &#123;</span><br><span class="line">            eventHandlers.put(EventType.DELETE_ROWS, <span class="keyword">this</span>::handleDelete);</span><br><span class="line">            eventHandlers.put(EventType.EXT_DELETE_ROWS, <span class="keyword">this</span>::handleDelete);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        eventHandlers.put(EventType.VIEW_CHANGE, <span class="keyword">this</span>::viewChange);</span><br><span class="line">        eventHandlers.put(EventType.XA_PREPARE, <span class="keyword">this</span>::prepareTransaction);</span><br><span class="line">        eventHandlers.put(EventType.XID, <span class="keyword">this</span>::handleTransactionCompletion);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Conditionally register ROWS_QUERY handler to parse SQL statements.</span></span><br><span class="line">        <span class="keyword">if</span> (context.includeSqlQuery()) &#123;</span><br><span class="line">            eventHandlers.put(EventType.ROWS_QUERY, <span class="keyword">this</span>::handleRowsQuery);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//MySQL5.6开始增加了强大的GTID（Global Transaction ID，全局事务ID）这个特性，用来强化数据库的主备一致性， 故障恢复， 以及容错能力。用于取代过去传统的主从复制</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> isGtidModeEnabled = connectionContext.isGtidModeEnabled();	</span><br><span class="line">        metrics.setIsGtidModeEnabled(isGtidModeEnabled);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the current GtidSet from MySQL so we can get a filtered/merged GtidSet based off of the last Debezium checkpoint.</span></span><br><span class="line">        String availableServerGtidStr = connectionContext.knownGtidSet();</span><br><span class="line">        <span class="keyword">if</span> (isGtidModeEnabled) &#123;</span><br><span class="line">            <span class="comment">// The server is using GTIDs, so enable the handler ...</span></span><br><span class="line">            eventHandlers.put(EventType.GTID, <span class="keyword">this</span>::handleGtidEvent);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Now look at the GTID set from the server and what we&#x27;ve previously seen ...</span></span><br><span class="line">            GtidSet availableServerGtidSet = <span class="keyword">new</span> GtidSet(availableServerGtidStr);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// also take into account purged GTID logs</span></span><br><span class="line">            GtidSet purgedServerGtidSet = connectionContext.purgedGtidSet();</span><br><span class="line">            logger.info(<span class="string">&quot;GTID set purged on server: &#123;&#125;&quot;</span>, purgedServerGtidSet);</span><br><span class="line"></span><br><span class="line">            GtidSet filteredGtidSet = context.filterGtidSet(availableServerGtidSet, purgedServerGtidSet);</span><br><span class="line">            <span class="keyword">if</span> (filteredGtidSet != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// We&#x27;ve seen at least some GTIDs, so start reading from the filtered GTID set ...</span></span><br><span class="line">                logger.info(<span class="string">&quot;Registering binlog reader with GTID set: &#123;&#125;&quot;</span>, filteredGtidSet);</span><br><span class="line">                String filteredGtidSetStr = filteredGtidSet.toString();</span><br><span class="line">                client.setGtidSet(filteredGtidSetStr);</span><br><span class="line">                source.setCompletedGtidSet(filteredGtidSetStr);</span><br><span class="line">                gtidSet = <span class="keyword">new</span> com.github.shyiko.mysql.binlog.GtidSet(filteredGtidSetStr);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// We&#x27;ve not yet seen any GTIDs, so that means we have to start reading the binlog from the beginning ...</span></span><br><span class="line">                client.setBinlogFilename(source.binlogFilename());</span><br><span class="line">                client.setBinlogPosition(source.binlogPosition());</span><br><span class="line">                gtidSet = <span class="keyword">new</span> com.github.shyiko.mysql.binlog.GtidSet(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// The server is not using GTIDs, so start reading the binlog based upon where we last left off ...</span></span><br><span class="line">            client.setBinlogFilename(source.binlogFilename());</span><br><span class="line">            client.setBinlogPosition(source.binlogPosition());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We may be restarting in the middle of a transaction, so see how far into the transaction we have already processed...</span></span><br><span class="line">        initialEventsToSkip = source.eventsToSkipUponRestart();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set the starting row number, which is the next row number to be read ...</span></span><br><span class="line">        startingRowNumber = source.rowsToSkipUponRestart();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Only when we reach the first BEGIN event will we start to skip events ...</span></span><br><span class="line">        skipEvent = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Initial our poll output delay logic ...</span></span><br><span class="line">        pollOutputDelay.hasElapsed();</span><br><span class="line">        previousOutputMillis = clock.currentTimeInMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Start the log reader, which starts background threads ...</span></span><br><span class="line">        <span class="keyword">if</span> (isRunning()) &#123;</span><br><span class="line">            <span class="keyword">long</span> timeout = context.getConnectorConfig().getConnectionTimeout().toMillis();</span><br><span class="line">            <span class="keyword">long</span> started = context.getClock().currentTimeInMillis();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                logger.debug(<span class="string">&quot;Attempting to establish binlog reader connection with timeout of &#123;&#125; ms&quot;</span>, timeout);</span><br><span class="line">                <span class="comment">//调用com.github.shyiko.mysql.binlog.BinaryLogClient的public void connect(final long timeout)方法</span></span><br><span class="line">                client.connect(timeout);	</span><br><span class="line">                <span class="comment">// Need to wait for keepalive thread to be running, otherwise it can be left orphaned</span></span><br><span class="line">                <span class="comment">// The problem is with timing. When the close is called too early after connect then</span></span><br><span class="line">                <span class="comment">// the keepalive thread is not terminated</span></span><br><span class="line">                <span class="keyword">if</span> (client.isKeepAlive()) &#123;</span><br><span class="line">                    logger.info(<span class="string">&quot;Waiting for keepalive thread to start&quot;</span>);</span><br><span class="line">                    <span class="keyword">final</span> Metronome metronome = Metronome.parker(Duration.ofMillis(<span class="number">100</span>), clock);</span><br><span class="line">                    <span class="keyword">int</span> waitAttempts = <span class="number">50</span>;</span><br><span class="line">                    <span class="keyword">boolean</span> keepAliveThreadRunning = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">while</span> (!keepAliveThreadRunning &amp;&amp; waitAttempts-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (Thread t : binaryLogClientThreads.values()) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (t.getName().startsWith(KEEPALIVE_THREAD_NAME) &amp;&amp; t.isAlive()) &#123;</span><br><span class="line">                                logger.info(<span class="string">&quot;Keepalive thread is running&quot;</span>);</span><br><span class="line">                                keepAliveThreadRunning = <span class="keyword">true</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        metronome.pause();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (TimeoutException e) &#123;</span><br><span class="line">                <span class="comment">// If the client thread is interrupted *before* the client could connect, the client throws a timeout exception</span></span><br><span class="line">                <span class="comment">// The only way we can distinguish this is if we get the timeout exception before the specified timeout has</span></span><br><span class="line">                <span class="comment">// elapsed, so we simply check this (within 10%) ...</span></span><br><span class="line">                <span class="keyword">long</span> duration = context.getClock().currentTimeInMillis() - started;</span><br><span class="line">                <span class="keyword">if</span> (duration &gt; (<span class="number">0.9</span> * timeout)) &#123;</span><br><span class="line">                    <span class="keyword">double</span> actualSeconds = TimeUnit.MILLISECONDS.toSeconds(duration);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(<span class="string">&quot;Timed out after &quot;</span> + actualSeconds + <span class="string">&quot; seconds while waiting to connect to MySQL at &quot;</span> +</span><br><span class="line">                            connectionContext.hostname() + <span class="string">&quot;:&quot;</span> + connectionContext.port() + <span class="string">&quot; with user &#x27;&quot;</span> + connectionContext.username() + <span class="string">&quot;&#x27;&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// Otherwise, we were told to shutdown, so we don&#x27;t care about the timeout exception</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (AuthenticationException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(<span class="string">&quot;Failed to authenticate to the MySQL database at &quot;</span> +</span><br><span class="line">                        connectionContext.hostname() + <span class="string">&quot;:&quot;</span> + connectionContext.port() + <span class="string">&quot; with user &#x27;&quot;</span> + connectionContext.username() + <span class="string">&quot;&#x27;&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConnectException(<span class="string">&quot;Unable to connect to the MySQL database at &quot;</span> +</span><br><span class="line">                        connectionContext.hostname() + <span class="string">&quot;:&quot;</span> + connectionContext.port() + <span class="string">&quot; with user &#x27;&quot;</span> + connectionContext.username() + <span class="string">&quot;&#x27;: &quot;</span> + e.getMessage(), e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="com-github-shyiko-mysql-binlog-BinaryLogClient"><a href="#com-github-shyiko-mysql-binlog-BinaryLogClient" class="headerlink" title="com.github.shyiko.mysql.binlog.BinaryLogClient"></a>com.github.shyiko.mysql.binlog.BinaryLogClient</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryLogClient</span> <span class="keyword">implements</span> <span class="title">BinaryLogClientMXBean</span> </span>&#123;</span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="title">BinaryLogClient</span><span class="params">(String hostname, <span class="keyword">int</span> port, String schema, String username, String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.logger = Logger.getLogger(<span class="keyword">this</span>.getClass().getName());</span><br><span class="line">        <span class="keyword">this</span>.blocking = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.serverId = <span class="number">65535L</span>;</span><br><span class="line">        <span class="keyword">this</span>.binlogPosition = <span class="number">4L</span>;</span><br><span class="line">        <span class="keyword">this</span>.sslMode = SSLMode.DISABLED;</span><br><span class="line">        <span class="keyword">this</span>.gtidSetAccessLock = <span class="keyword">new</span> Object();</span><br><span class="line">        <span class="keyword">this</span>.eventDeserializer = <span class="keyword">new</span> EventDeserializer();	<span class="comment">//时间解析器</span></span><br><span class="line">        <span class="keyword">this</span>.eventListeners = <span class="keyword">new</span> CopyOnWriteArrayList();	<span class="comment">//时间监听list</span></span><br><span class="line">        <span class="keyword">this</span>.lifecycleListeners = <span class="keyword">new</span> CopyOnWriteArrayList();</span><br><span class="line">        <span class="keyword">this</span>.masterServerId = -<span class="number">1L</span>;</span><br><span class="line">        <span class="keyword">this</span>.keepAlive = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.keepAliveInterval = TimeUnit.MINUTES.toMillis(<span class="number">1L</span>);</span><br><span class="line">        <span class="keyword">this</span>.connectTimeout = TimeUnit.SECONDS.toMillis(<span class="number">3L</span>);</span><br><span class="line">        <span class="keyword">this</span>.connectLock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">        <span class="keyword">this</span>.keepAliveThreadExecutorLock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">        <span class="keyword">this</span>.hostname = hostname;	<span class="comment">//主机名</span></span><br><span class="line">        <span class="keyword">this</span>.port = port;	<span class="comment">//数据库端口</span></span><br><span class="line">        <span class="keyword">this</span>.schema = schema;	<span class="comment">//数据库名</span></span><br><span class="line">        <span class="keyword">this</span>.username = username;	<span class="comment">//数据库用户名</span></span><br><span class="line">        <span class="keyword">this</span>.password = password;	<span class="comment">//数据库密码</span></span><br><span class="line"> 	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connect</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.connectLock.tryLock()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;BinaryLogClient is already connected&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">boolean</span> notifyWhenDisconnected = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">boolean</span> var22 = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                var22 = <span class="keyword">true</span>;</span><br><span class="line">                Callable cancelDisconnect = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">                        <span class="keyword">this</span>.channel = <span class="keyword">this</span>.openChannel();</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">this</span>.connectTimeout &gt; <span class="number">0L</span> &amp;&amp; !<span class="keyword">this</span>.isKeepAliveThreadRunning()) &#123;</span><br><span class="line">                            cancelDisconnect = <span class="keyword">this</span>.scheduleDisconnectIn(<span class="keyword">this</span>.connectTimeout - (System.currentTimeMillis() - start));</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">this</span>.channel.getInputStream().peek() == -<span class="number">1</span>) &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> EOFException();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException var35) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">&quot;Failed to connect to MySQL on &quot;</span> + <span class="keyword">this</span>.hostname + <span class="string">&quot;:&quot;</span> + <span class="keyword">this</span>.port + <span class="string">&quot;. Please make sure it&#x27;s running.&quot;</span>, var35);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    GreetingPacket greetingPacket = <span class="keyword">this</span>.receiveGreeting();</span><br><span class="line">                    <span class="keyword">this</span>.tryUpgradeToSSL(greetingPacket);</span><br><span class="line">                    (<span class="keyword">new</span> Authenticator(greetingPacket, <span class="keyword">this</span>.channel, <span class="keyword">this</span>.schema, <span class="keyword">this</span>.username, <span class="keyword">this</span>.password)).authenticate();</span><br><span class="line">                    <span class="keyword">this</span>.channel.authenticationComplete();</span><br><span class="line">                    <span class="keyword">this</span>.connectionId = greetingPacket.getThreadId();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(<span class="keyword">this</span>.binlogFilename)) &#123;</span><br><span class="line">                        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.gtidSetAccessLock) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">this</span>.gtidSet != <span class="keyword">null</span> &amp;&amp; <span class="string">&quot;&quot;</span>.equals(<span class="keyword">this</span>.gtidSet.toString()) &amp;&amp; <span class="keyword">this</span>.gtidSetFallbackToPurged) &#123;</span><br><span class="line">                                <span class="keyword">this</span>.gtidSet = <span class="keyword">new</span> GtidSet(<span class="keyword">this</span>.fetchGtidPurged());</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.binlogFilename == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.fetchBinlogFilenameAndPosition();	<span class="comment">//获取binlog文件名和位置</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.binlogPosition &lt; <span class="number">4L</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isLoggable(Level.WARNING)) &#123;</span><br><span class="line">                            <span class="keyword">this</span>.logger.warning(<span class="string">&quot;Binary log position adjusted from &quot;</span> + <span class="keyword">this</span>.binlogPosition + <span class="string">&quot; to &quot;</span> + <span class="number">4</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">this</span>.binlogPosition = <span class="number">4L</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    ChecksumType checksumType = <span class="keyword">this</span>.fetchBinlogChecksum();</span><br><span class="line">                    <span class="keyword">if</span> (checksumType != ChecksumType.NONE) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.confirmSupportOfChecksum(checksumType);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">this</span>.setMasterServerId();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.heartbeatInterval &gt; <span class="number">0L</span>) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.enableHeartbeat();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">this</span>.gtid = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">this</span>.tx = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">this</span>.requestBinaryLogStream();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException var36) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.disconnectChannel();</span><br><span class="line">                    <span class="keyword">throw</span> var36;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cancelDisconnect != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            cancelDisconnect.call();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception var34) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isLoggable(Level.WARNING)) &#123;</span><br><span class="line">                                <span class="keyword">this</span>.logger.warning(<span class="string">&quot;\&quot;&quot;</span> + var34.getMessage() + <span class="string">&quot;\&quot; was thrown while canceling scheduled disconnect call&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">this</span>.connected = <span class="keyword">true</span>;</span><br><span class="line">                notifyWhenDisconnected = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isLoggable(Level.INFO)) &#123;</span><br><span class="line">                    String position;</span><br><span class="line">                    <span class="keyword">synchronized</span>(<span class="keyword">this</span>.gtidSetAccessLock) &#123;</span><br><span class="line">                        position = <span class="keyword">this</span>.gtidSet != <span class="keyword">null</span> ? <span class="keyword">this</span>.gtidSet.toString() : <span class="keyword">this</span>.binlogFilename + <span class="string">&quot;/&quot;</span> + <span class="keyword">this</span>.binlogPosition;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">this</span>.logger.info(<span class="string">&quot;Connected to &quot;</span> + <span class="keyword">this</span>.hostname + <span class="string">&quot;:&quot;</span> + <span class="keyword">this</span>.port + <span class="string">&quot; at &quot;</span> + position + <span class="string">&quot; (&quot;</span> + (<span class="keyword">this</span>.blocking ? <span class="string">&quot;sid:&quot;</span> + <span class="keyword">this</span>.serverId + <span class="string">&quot;, &quot;</span> : <span class="string">&quot;&quot;</span>) + <span class="string">&quot;cid:&quot;</span> + <span class="keyword">this</span>.connectionId + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Iterator var43 = <span class="keyword">this</span>.lifecycleListeners.iterator();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span>(var43.hasNext()) &#123;</span><br><span class="line">                    BinaryLogClient.LifecycleListener lifecycleListener = (BinaryLogClient.LifecycleListener)var43.next();</span><br><span class="line">                    lifecycleListener.onConnect(<span class="keyword">this</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.keepAlive &amp;&amp; !<span class="keyword">this</span>.isKeepAliveThreadRunning()) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.spawnKeepAliveThread();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">this</span>.ensureEventDataDeserializer(EventType.ROTATE, RotateEventDataDeserializer.class);</span><br><span class="line">                <span class="keyword">synchronized</span>(<span class="keyword">this</span>.gtidSetAccessLock) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.gtidSet != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">//调用实例化事件解析器方法</span></span><br><span class="line">                        <span class="keyword">this</span>.ensureEventDataDeserializer(EventType.GTID, GtidEventDataDeserializer.class);</span><br><span class="line">                        <span class="keyword">this</span>.ensureEventDataDeserializer(EventType.QUERY, QueryEventDataDeserializer.class);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">this</span>.listenForEventPackets();</span><br><span class="line">                var22 = <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (var22) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.connectLock.unlock();</span><br><span class="line">                    <span class="keyword">if</span> (notifyWhenDisconnected) &#123;</span><br><span class="line">                        Iterator var11 = <span class="keyword">this</span>.lifecycleListeners.iterator();</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">while</span>(var11.hasNext()) &#123;</span><br><span class="line">                            BinaryLogClient.LifecycleListener lifecycleListener = (BinaryLogClient.LifecycleListener)var11.next();</span><br><span class="line">                            lifecycleListener.onDisconnect(<span class="keyword">this</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.connectLock.unlock();</span><br><span class="line">            <span class="keyword">if</span> (notifyWhenDisconnected) &#123;</span><br><span class="line">                Iterator var40 = <span class="keyword">this</span>.lifecycleListeners.iterator();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span>(var40.hasNext()) &#123;</span><br><span class="line">                    BinaryLogClient.LifecycleListener lifecycleListener = (BinaryLogClient.LifecycleListener)var40.next();</span><br><span class="line">                    lifecycleListener.onDisconnect(<span class="keyword">this</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//注册监听器方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerEventListener</span><span class="params">(BinaryLogClient.EventListener eventListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.eventListeners.add(eventListener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="com-github-shyiko-mysql-binlog-event-deserialization-EventDeserializer"><a href="#com-github-shyiko-mysql-binlog-event-deserialization-EventDeserializer" class="headerlink" title="com.github.shyiko.mysql.binlog.event.deserialization.EventDeserializer"></a>com.github.shyiko.mysql.binlog.event.deserialization.EventDeserializer</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventDeserializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Deserializer</span> <span class="keyword">implements</span> <span class="title">EventDataDeserializer</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> EventDataDeserializer internal;</span><br><span class="line">            <span class="keyword">private</span> EventDataDeserializer external;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">Deserializer</span><span class="params">(EventDataDeserializer internal, EventDataDeserializer external)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.internal = internal;</span><br><span class="line">                <span class="keyword">this</span>.external = external;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">                </span><br><span class="line">            <span class="comment">//将事件流解析为事件数据对象</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> EventData <span class="title">deserialize</span><span class="params">(ByteArrayInputStream inputStream)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="keyword">byte</span>[] bytes = inputStream.read(inputStream.available());</span><br><span class="line">                EventData internalEventData = <span class="keyword">this</span>.internal.deserialize(<span class="keyword">new</span> ByteArrayInputStream(bytes));</span><br><span class="line">                EventData externalEventData = <span class="keyword">this</span>.external.deserialize(<span class="keyword">new</span> ByteArrayInputStream(bytes));</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> EventDeserializer.EventDataWrapper(internalEventData, externalEventData);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    	<span class="comment">//解析数据流为事件</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Event <span class="title">nextEvent</span><span class="params">(ByteArrayInputStream inputStream)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (inputStream.peek() == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            EventHeader eventHeader = <span class="keyword">this</span>.eventHeaderDeserializer.deserialize(inputStream);</span><br><span class="line">            EventData eventData;</span><br><span class="line">            <span class="keyword">switch</span>(eventHeader.getEventType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> FORMAT_DESCRIPTION:</span><br><span class="line">                eventData = <span class="keyword">this</span>.deserializeFormatDescriptionEventData(inputStream, eventHeader);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> TABLE_MAP:</span><br><span class="line">                eventData = <span class="keyword">this</span>.deserializeTableMapEventData(inputStream, eventHeader);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                EventDataDeserializer eventDataDeserializer = <span class="keyword">this</span>.getEventDataDeserializer(eventHeader.getEventType());</span><br><span class="line">                eventData = <span class="keyword">this</span>.deserializeEventData(inputStream, eventHeader, eventDataDeserializer);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Event(eventHeader, eventData);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="io-debezium-connector-mysql-ChainedReader"><a href="#io-debezium-connector-mysql-ChainedReader" class="headerlink" title="io.debezium.connector.mysql.ChainedReader"></a>io.debezium.connector.mysql.ChainedReader</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ChainedReader</span> <span class="keyword">implements</span> <span class="title">Reader</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (running.compareAndSet(<span class="keyword">false</span>, <span class="keyword">true</span>)) &#123;</span><br><span class="line">            completed.set(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Build up the list of readers that need to be called ...</span></span><br><span class="line">            remainingReaders.clear();</span><br><span class="line">            readers.forEach(remainingReaders::add);	<span class="comment">//循环添加进LinkedList&lt;Reader&gt; remainingReaders</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// Start the first reader, if there is one ...</span></span><br><span class="line">            <span class="keyword">if</span> (!startNextReader()) &#123;	<span class="comment">//调用当前类startNextReader方法</span></span><br><span class="line">                <span class="comment">// We couldn&#x27;t start it ...</span></span><br><span class="line">                running.set(<span class="keyword">false</span>);</span><br><span class="line">                completed.set(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">startNextReader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Reader reader = remainingReaders.isEmpty() ? <span class="keyword">null</span> : remainingReaders.pop();</span><br><span class="line">        <span class="keyword">if</span> (reader == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// There are no readers, so nothing to do ...</span></span><br><span class="line">            Reader lastReader = currentReader.getAndSet(<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (lastReader != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// Make sure it has indeed stopped ...</span></span><br><span class="line">                lastReader.stop();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// There is at least one more reader, so start it ...</span></span><br><span class="line">        Reader lastReader = currentReader.getAndSet(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (lastReader != <span class="keyword">null</span>) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;Transitioning from the &#123;&#125; reader to the &#123;&#125; reader&quot;</span>, lastReader.name(), reader.name());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;Starting the &#123;&#125; reader&quot;</span>, reader.name());</span><br><span class="line">        &#125;</span><br><span class="line">        reader.start();	<span class="comment">//当前reader执行start方法，io.debezium.connector.mysql.AbstractReader</span></span><br><span class="line">        currentReader.set(reader);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="io-debezium-connector-mysql-AbstractReader"><a href="#io-debezium-connector-mysql-AbstractReader" class="headerlink" title="io.debezium.connector.mysql.AbstractReader"></a>io.debezium.connector.mysql.AbstractReader</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractReader</span> <span class="keyword">implements</span> <span class="title">Reader</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.running.compareAndSet(<span class="keyword">false</span>, <span class="keyword">true</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.failure.set(<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">this</span>.success.set(<span class="keyword">false</span>);</span><br><span class="line">            doStart();	<span class="comment">//调用 io.debezium.connector.mysql.BinlogReader的dostart方法</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/18/Debezuim/debezuim%E6%BA%90%E7%A0%81/" data-id="ckk2gq3ul001tz8pqgvvc0jzy" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Debezuim/debezuim_ch" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/18/Debezuim/debezuim_ch/" class="article-date">
  <time class="dt-published" datetime="2021-01-18T11:01:37.216Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="http://www.apache.org/licenses/LICENSE-2.0.html"><img src="http://img.shields.io/:license-apache%202.0-brightgreen.svg" alt="License"></a><br><a target="_blank" rel="noopener" href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22io.debezium%22"><img src="https://maven-badges.herokuapp.com/maven-central/io.debezium/debezium-parent/badge.svg" alt="Maven Central"></a><br><a target="_blank" rel="noopener" href="https://travis-ci.org/debezium/debezium"><img src="https://travis-ci.org/debezium/debezium.svg?branch=master" alt="Build Status"></a><br><a target="_blank" rel="noopener" href="https://gitter.im/debezium/user"><img src="https://img.shields.io/badge/chat-users-brightgreen.svg" alt="User chat"></a><br><a target="_blank" rel="noopener" href="https://gitter.im/debezium/dev"><img src="https://img.shields.io/badge/chat-devs-brightgreen.svg" alt="Developer chat"></a><br><a target="_blank" rel="noopener" href="https://groups.google.com/forum/#!forum/debezium"><img src="https://img.shields.io/:mailing%20list-debezium-brightgreen.svg" alt="Google Group"></a><br><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/tagged/debezium"><img src="http://img.shields.io/:stack%20overflow-debezium-brightgreen.svg" alt="Stack Overflow"></a></p>
<p>Copyright Debezium Authors.<br>Licensed under the <a target="_blank" rel="noopener" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br>The Antlr grammars within the debezium-ddl-parser module are licensed under the <a target="_blank" rel="noopener" href="https://opensource.org/licenses/MIT">MIT License</a>.</p>
<p>中文 | <a href="README.md">English</a></p>
<h1 id="Debezium-简介"><a href="#Debezium-简介" class="headerlink" title="Debezium 简介"></a>Debezium 简介</h1><p>Debezium是一个开源项目，为捕获数据更改(change data capture,CDC)提供了一个低延迟的流式处理平台。你可以安装并且配置Debezium去监控你的数据库，然后你的应用就可以消费对数据库的每一个行级别(row-level)的更改。只有已提交的更改才是可见的，所以你的应用不用担心事务(transaction)或者更改被回滚(roll back)。Debezium为所有的数据库更改事件提供了一个统一的模型，所以你的应用不用担心每一种数据库管理系统的错综复杂性。另外，由于Debezium用持久化的、有副本备份的日志来记录数据库数据变化的历史，因此，你的应用可以随时停止再重启，而不会错过它停止运行时发生的事件，保证了所有的事件都能被正确地、完全地处理掉。</p>
<p>监控数据库，并且在数据变动的时候获得通知一直是很复杂的事情。关系型数据库的触发器可以做到，但是只对特定的数据库有效，而且通常只能更新数据库内的状态(无法和外部的进程通信)。一些数据库提供了监控数据变动的API或者框架，但是没有一个标准，每种数据库的实现方式都是不同的，并且需要大量特定的知识和理解特定的代码才能运用。确保以相同的顺序查看和处理所有更改，同时最小化影响数据库仍然非常具有挑战性。</p>
<p>Debezium提供了模块为你做这些复杂的工作。一些模块是通用的，并且能够适用多种数据库管理系统，但在功能和性能方面仍有一些限制。另一些模块是为特定的数据库管理系统定制的，所以他们通常可以更多地利用数据库系统本身的特性来提供更多功能。</p>
<h2 id="Debezium基础架构"><a href="#Debezium基础架构" class="headerlink" title="Debezium基础架构"></a>Debezium基础架构</h2><p>Debezium是一个捕获数据更改(CDC)平台，并且利用Kafka和Kafka Connect实现了自己的持久性、可靠性和容错性。每一个部署在Kafka Connect分布式的、可扩展的、容错性的服务中的connector监控一个上游数据库服务器，捕获所有的数据库更改，然后记录到一个或者多个Kafka topic(通常一个数据库表对应一个kafka topic)。Kafka确保所有这些数据更改事件都能够多副本并且总体上有序(Kafka只能保证一个topic的单个分区内有序)，这样，更多的客户端可以独立消费同样的数据更改事件而对上游数据库系统造成的影响降到很小(如果N个应用都直接去监控数据库更改，对数据库的压力为N，而用debezium汇报数据库更改事件到kafka，所有的应用都去消费kafka中的消息，可以把对数据库的压力降到1)。另外，客户端可以随时停止消费，然后重启，从上次停止消费的地方接着消费。每个客户端可以自行决定他们是否需要exactly-once或者at-least-once消息交付语义保证，并且所有的数据库或者表的更改事件是按照上游数据库发生的顺序被交付的。</p>
<p>对于不需要或者不想要这种容错级别、性能、可扩展性、可靠性的应用，他们可以使用内嵌的Debezium connector引擎来直接在应用内部运行connector。这种应用仍需要消费数据库更改事件，但更希望connector直接传递给它，而不是持久化到Kafka里。</p>
<h2 id="常见使用场景"><a href="#常见使用场景" class="headerlink" title="常见使用场景"></a>常见使用场景</h2><p>Debezium有很多非常有价值的使用场景，我们在这儿仅仅列出几个更常见的使用场景。</p>
<h3 id="缓存失效-Cache-invalidation"><a href="#缓存失效-Cache-invalidation" class="headerlink" title="缓存失效(Cache invalidation)"></a>缓存失效(Cache invalidation)</h3><p>在缓存中缓存的条目(entry)在源头被更改或者被删除的时候立即让缓存中的条目失效。如果缓存在一个独立的进程中运行(例如Redis，Memcache，Infinispan或者其他的)，那么简单的缓存失效逻辑可以放在独立的进程或服务中，从而简化主应用的逻辑。在一些场景中，缓存失效逻辑可以更复杂一点，让它利用更改事件中的更新数据去更新缓存中受影响的条目。</p>
<h3 id="简化单体应用-Simplifying-monolithic-applications"><a href="#简化单体应用-Simplifying-monolithic-applications" class="headerlink" title="简化单体应用(Simplifying monolithic applications)"></a>简化单体应用(Simplifying monolithic applications)</h3><p>许多应用更新数据库，然后在数据库中的更改被提交后，做一些额外的工作：更新搜索索引，更新缓存，发送通知，运行业务逻辑，等等。这种情况通常称为双写(dual-writes)，因为应用没有在一个事务内写多个系统。这样不仅应用逻辑复杂难以维护，而且双写容易丢失数据或者在一些系统更新成功而另一些系统没有更新成功的时候造成不同系统之间的状态不一致。使用捕获更改数据技术(change data capture,CDC)，在源数据库的数据更改提交后，这些额外的工作可以被放在独立的线程或者进程(服务)中完成。这种实现方式的容错性更好，不会丢失事件，容易扩展，并且更容易支持升级。</p>
<h3 id="共享数据库-Sharing-databases"><a href="#共享数据库-Sharing-databases" class="headerlink" title="共享数据库(Sharing databases)"></a>共享数据库(Sharing databases)</h3><p> 当多个应用共用同一个数据库的时候，一个应用提交的更改通常要被另一个应用感知到。一种实现方式是使用消息总线，尽管非事务性(non-transactional)的消息总线总会受上面提到的双写(dual-writes)影响。但是，另一种实现方式，即Debezium，变得很直接：每个应用可以直接监控数据库的更改，并且响应更改。</p>
<h3 id="数据集成-Data-integration"><a href="#数据集成-Data-integration" class="headerlink" title="数据集成(Data integration)"></a>数据集成(Data integration)</h3><p>数据通常被存储在多个地方，尤其是当数据被用于不同的目的的时候，会有不同的形式。保持多系统的同步是很有挑战性的，但是可以通过使用Debezium加上简单的事件处理逻辑来实现简单的ETL类型的解决方案。</p>
<h3 id="命令查询职责分离-CQRS"><a href="#命令查询职责分离-CQRS" class="headerlink" title="命令查询职责分离(CQRS)"></a>命令查询职责分离(CQRS)</h3><p>在命令查询职责分离 <a target="_blank" rel="noopener" href="http://martinfowler.com/bliki/CQRS.html">Command Query Responsibility Separation (CQRS)</a> 架构模式中，更新数据使用了一种数据模型，读数据使用了一种或者多种数据模型。由于数据更改被记录在更新侧(update-side)，这些更改将被处理以更新各种读展示。所以CQRS应用通常更复杂，尤其是他们需要保证可靠性和全序(totally-ordered)处理。Debezium和CDC可以使这种方式更可行：写操作被正常记录，但是Debezium捕获数据更改，并且持久化到全序流里，然后供那些需要异步更新只读视图的服务消费。写侧(write-side)表可以表示面向领域的实体(domain-oriented entities)，或者当CQRS和 <a target="_blank" rel="noopener" href="http://martinfowler.com/eaaDev/EventSourcing.html">Event Sourcing</a> 结合的时候，写侧表仅仅用做追加操作命令事件的日志。</p>
<h2 id="Building-Debezium"><a href="#Building-Debezium" class="headerlink" title="Building Debezium"></a>Building Debezium</h2><p>使用Debezium代码库并在本地配置它需要以下软件：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://git-scm.com/">Git 2.2.1</a> or later</li>
<li><a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">JDK 8</a> or <a target="_blank" rel="noopener" href="http://openjdk.java.net/projects/jdk8/">OpenJDK 8</a></li>
<li><a target="_blank" rel="noopener" href="https://maven.apache.org/index.html">Maven 3.2.1</a> or later</li>
<li><a target="_blank" rel="noopener" href="http://docs.docker.com/engine/installation/">Docker Engine 1.9</a> or later</li>
</ul>
<p>有关平台上的安装说明，请参阅上面的链接。您可以通过以下指令查看安装版本</p>
<pre><code>$ git --version
$ javac -version
$ mvn -version
$ docker --version</code></pre>
<h3 id="为什么选用-Docker"><a href="#为什么选用-Docker" class="headerlink" title="为什么选用 Docker?"></a>为什么选用 Docker?</h3><p>许多开源软件项目使用Git、Java和Maven，但需要Docker的情况不太常见。Debezium被设计用来与许多外部系统进行通信，比如各种数据库和服务，我们的集成测试验证了Debezium成功地做到了这一点。但Debezium的构建系统使用Docker自动下载或创建必要的映像，并为每个系统启动容器，而不是期望您在本地安装所有这些软件系统。然后，集成测试可以使用这些服务并验证Debezium的行为是否符合预期，当集成测试完成时，Debezium将自动停止它启动的所有容器.</p>
<p>Debezium还有一些不是用Java编写的模块，因此它们必须在目标操作系统上使用。Docker让我们的构建使用目标操作系统的映像和所有必要的开发工具来完成。</p>
<p>使用Docker有几个优点：</p>
<ol>
<li>不需要在本地计算机上安装、配置和运行每个所依赖的外部服务的特定版本，也不必在本地网络上访问它们。即使配置了，Debezium也不会用到它们。</li>
<li>我们可以测试外部服务的多个版本。每个模块可以启动它需要的任何容器，因此不同的模块可以轻松地使用不同版本的服务。</li>
<li>每个人都可以在本地运行完整的构建。 不必依赖远程持续集成服务器在设置了所有必需服务的环境中运行构建。</li>
<li>所有构建都是一致的。当多个开发人员各自构建相同的代码库时，他们应该看到完全相同的结果——只要他们使用相同或等效的JDK、Maven和Docker版本。这是因为容器将在相同的操作系统上运行相同版本的服务。另外，所有的测试都是为了连接到运行在容器中的系统而设计的，因此没有人需要修改连接属性或特定于其本地环境的自定义配置。</li>
<li>不需要清理服务, 即使这些服务在本地修改和存储数据. Docker <em>images</em> 被缓存, 所以 reusing 服务可以快速的启动容器并保持一致性, 但是Docker <em>containers</em> 永远不会被重用：它们总是在原始的初始状态下启动，在关闭时被丢弃。集成测试依赖于容器，因此清理是自动处理的</li>
</ol>
<h3 id="配置Docker环境"><a href="#配置Docker环境" class="headerlink" title="配置Docker环境"></a>配置Docker环境</h3><p>Docker Maven插件通过检查以下环境变量来解析Docker主机：</p>
<pre><code>export DOCKER_HOST=tcp://10.1.2.2:2376
export DOCKER_CERT_PATH=/path/to/cdk/.vagrant/machines/default/virtualbox/.docker
export DOCKER_TLS_VERIFY=1</code></pre>
<p>Docker类似的容器可以自动配置这些参数。</p>
<h3 id="项目编译"><a href="#项目编译" class="headerlink" title="项目编译"></a>项目编译</h3><p>首先从Git存储库获取代码：</p>
<pre><code>$ git clone https://github.com/debezium/debezium.git
$ cd debezium</code></pre>
<p>用maven构建项目<br>    $ mvn clean install</p>
<p>为不同的dbms使用不同的容器构建。请注意，如果Docker未运行或未配置，则可能会出现一个神秘的错误——如果是这种情况，请始终验证Docker是否正在运行，也许可以使用Docker ps列出正在运行的容器。</p>
<h3 id="本地没有Docker"><a href="#本地没有Docker" class="headerlink" title="本地没有Docker?"></a>本地没有Docker?</h3><p>您可以使用以下命令跳过集成测试和docker来构建项目：</p>
<pre><code>$ mvn clean install -DskipITs</code></pre>
<h3 id="使用wal2json或-pgoutput-logical-decoding-plug-ins-运行Postgres-connector的测试"><a href="#使用wal2json或-pgoutput-logical-decoding-plug-ins-运行Postgres-connector的测试" class="headerlink" title="使用wal2json或 pgoutput logical decoding plug-ins 运行Postgres connector的测试"></a>使用wal2json或 pgoutput logical decoding plug-ins 运行Postgres connector的测试</h3><p>Postgres连接器支持三个逻辑解码插件，用于从DB服务器到连接器的流式更改：decoderbufs（默认）、wal2json和pgoutput。要使用wal2json运行PG connector的集成测试，请启用“wal2json decoder”构建配置文件：</p>
<pre><code>$ mvn clean install -pl :debezium-connector-postgres -Pwal2json-decoder</code></pre>
<p>要使用pgoutput运行PG connector的集成测试，请启用“pgoutput decoder”和“postgres-10”构建配置文件：</p>
<pre><code>$ mvn clean install -pl :debezium-connector-postgres -Ppgoutput-decoder,postgres-10</code></pre>
<p>在使用wal2json插件时，一些测试目前无法通过。</p>
<p>查找对<code>io.debezium.connector.postgresql.DecoderDifferences</code>中定义的类型的引用以找到这些测试。</p>
<h3 id="对外部数据库运行Postgres连接器的测试-例如：Amazon-RDS"><a href="#对外部数据库运行Postgres连接器的测试-例如：Amazon-RDS" class="headerlink" title="对外部数据库运行Postgres连接器的测试, 例如：Amazon RDS"></a>对外部数据库运行Postgres连接器的测试, 例如：Amazon RDS</h3><p>如果您要针对非RDS集群进行测试，请注意<your user>须是超级用户，不仅要具有复制权限，而且还要有登录pg_hba.conf中所有数据库的权限。它还要求目标服务器上必须有 <em>postgis</em> 包，才能通过某些测试。</p>
<pre><code>$ mvn clean install -pl debezium-connector-postgres -Pwal2json-decoder \
     -Ddocker.skip.build=true -Ddocker.skip.run=true -Dpostgres.host=&lt;your PG host&gt; \
     -Dpostgres.user=&lt;your user&gt; -Dpostgres.password=&lt;your password&gt; \
     -Ddebezium.test.records.waittime=10</code></pre>
<p>根据需要调整超时值。</p>
<p>有关在RDS上设置要测试的数据库的详细信息，请参阅 <a href="debezium-connector-postgres/RDS.md">PostgreSQL on Amazon RDS</a> </p>
<h2 id="贡献源码-Contributing"><a href="#贡献源码-Contributing" class="headerlink" title="贡献源码(Contributing)"></a>贡献源码(Contributing)</h2><p>Debezium社区欢迎任何愿意以任何方式提供帮助的人，无论是报告问题、帮助文档，还是提供代码更改以修复错误、添加测试或实现新功能。有关详细信息，请参阅本<a href="CONTRIBUTE.md">文档</a>。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/18/Debezuim/debezuim_ch/" data-id="ckk2gq3t20003z8pqgctbagcv" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Aliun/阿里云的使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/18/Aliun/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2021-01-18T11:01:37.212Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="一、阿里云服务的类型"><a href="#一、阿里云服务的类型" class="headerlink" title="一、阿里云服务的类型"></a>一、阿里云服务的类型</h4><h5 id="1、轻量应用服务器-："><a href="#1、轻量应用服务器-：" class="headerlink" title="1、轻量应用服务器 ："></a>1、轻量应用服务器 ：</h5><p>是可快速搭建且易于管理的轻量级云服务器；提供基于单台服务器的应用部署，安全管理，运维监控等服务，一站式提升您的服务器使用体验和效率。轻量应用服务器 是 IaaS 产品，但是提供定制化应用镜像且有可视化控制台可以操作，不怕新手不会用。轻量应用服务器精简了一些 ECS 的功能，比如说安骑士。把安全组的操作也做了适当减法更适合用户操作。</p>
<p>特点：</p>
<p><strong>快速启动：</strong>30秒一键启动您的应用</p>
<p><strong>一站式体验：</strong>域名解析、网站发布、服务器管理等操作单界面集成，一站式功能体验</p>
<p><strong>精选镜像：</strong>阿里云自主研发和精选市场镜像双重选择，为您提供优质镜像体验</p>
<p><strong>丰富应用：</strong>持续提供多种应用功能，帮助您便捷的管理、配置、分析应用</p>
<h5 id="2、云服务器ECS："><a href="#2、云服务器ECS：" class="headerlink" title="2、云服务器ECS："></a>2、云服务器ECS：</h5><p>是阿里云提供的性能卓越、稳定可靠、弹性扩展的IaaS（Infrastructure as a Service）级别云计算服务。云服务器ECS免去了您采购IT硬件的前期准备，让您像使用水、电、天然气等公共资源一样便捷、高效地使用服务器，实现计算资源的即开即用和弹性伸缩。阿里云ECS持续提供创新型服务器，解决多种业务需求，助力您的业务发展。</p>
<p><strong>稳定：</strong>实例可用性达 99.95%，云盘采用99.9999999%可靠性设计，自动宕机迁移，自动快照备份，数据恢复更方便</p>
<p><strong>弹性：</strong>支持分钟级别创建1000台实例，多种弹性付费选择更贴合业务现状，同时带来弹性的扩容能力，实例与带宽均可随时升降配，云盘可扩容</p>
<p><strong>高安全：</strong>免费提供 DDoS 防护、木马查杀、防暴力破解等服务，通过多方国际安全认证，ECS云盘支持数据加密功能</p>
<p><strong>高性能：</strong>单实例最高可选88vCPU，内存704GB，单实例性能最高可达到700万PPS网络收发包，35Gbps带宽</p>
<p><strong>易用性：</strong>丰富的操作系统和应用软件，通过镜像可一键简单部署，同一镜像可在多台 ECS 中快速复制环境，轻松扩展</p>
<p><strong>可拓展性：</strong>ECS 可与阿里云各种丰富的云产品无缝衔接，可持续为业务发展提供完整的计算、存储、安全等解决方案</p>
<h5 id="3、性能突发型"><a href="#3、性能突发型" class="headerlink" title="3、性能突发型"></a>3、性能突发型</h5><p>突发性能实例的特性：突发性能实例（以下简称t5）有两个特性，即CPU基准性能和CPU积分，每台t5实例都有一个默认的CPU基准性能，比如：ecs.t5-c1m2.large这款t5实例，默认CPU基准性能为15%，即该实例在正常工作负载时，CPU使用率最大为15%，如果该实例CPU超过默认的基准性能就需要消耗更过的CPU积分，所以t5实例适用于CPU负载低的入门级用户</p>
<p>适合作为压测服务器使用或临时负载使用</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/18/Aliun/%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E4%BD%BF%E7%94%A8/" data-id="ckk2gq3t20002z8pq0o8n6io6" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/18/hello-world/" class="article-date">
  <time class="dt-published" datetime="2021-01-18T09:18:07.915Z" itemprop="datePublished">2021-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/18/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/18/hello-world/" data-id="ckk2db05i000038pqfatue4ud" data-title="Hello World" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/18/%E4%BA%91%E8%AE%A1%E7%AE%97/%E4%BA%91%E8%AE%A1%E7%AE%97%E5%B8%B8%E8%A7%81%E6%A6%82%E5%BF%B5/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/01/18/%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81/03_Redis%E5%AE%9E%E7%8E%B0%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/01/18/%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81/02_RabbitMQ%E5%AE%9E%E7%8E%B0%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/01/18/%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81/01_%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97%E7%9A%84%E6%96%B9%E6%A1%88%E4%BB%8B%E7%BB%8D/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/01/18/%E5%85%B6%E4%BB%96%E5%B0%8F%E6%8A%80%E5%B7%A7/github%E4%B8%8B%E8%BD%BD%E9%80%9F%E5%BA%A6%E5%A4%AA%E6%85%A2/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>